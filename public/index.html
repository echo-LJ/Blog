<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="blog">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-vueI18" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/vueI18/" class="article-date">
  <time datetime="2020-07-27T09:24:07.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/vueI18/">vue项目中引入&amp;使用国际化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>国际化思路：将当前语言代码-国家地区对照表（zh-CN）放到cookie中和vuex中,每次通过读取cookie&amp;vuex中的语言代码，来展示对应的语言包，在切换语言的时候将语言代码存入到cookie&amp;vuex中（保证刷新页面后能记住用户选择的语言）。<br>####引入vue-i18n&amp;vuex&amp;js-cookie<br>vue-i18n是vue国际化依赖包,vuex是状态管理。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save vue-i18n vuex js-cookie</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在main.js中注册引入即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import VueI18n from &apos;vue-i18n&apos;</span><br><span class="line">import Cookies from &apos;js-cookie&apos;</span><br><span class="line">Vue.use(VueI18n)</span><br><span class="line">import store from &apos;vuex&apos;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &apos;#app&apos;,</span><br><span class="line">  i18n,</span><br><span class="line">  store,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: &apos;&lt;App/&gt;&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>小编是将其放在store&amp;lang之中,在main.js中引入两个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import store from &apos;./store&apos;</span><br><span class="line">import i18n from &apos;./lang&apos;</span><br><span class="line">// 由于这里用到了element组件库，这里需要的同学自行安装element-ui</span><br><span class="line">// npm install element-ui</span><br><span class="line">//  Vue.use(Element, &#123;</span><br><span class="line">//  i18n: (key, value) =&gt; i18n.t(key, value)</span><br><span class="line">// &#125;)</span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &apos;#app&apos;,</span><br><span class="line">  router,</span><br><span class="line">  i18n,</span><br><span class="line">  store,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: &apos;&lt;App/&gt;&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>lang文件夹：当前以中英文为例，需要支持多个语言则可添加同级语言包。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lang</span><br><span class="line">  |--index.js   //主文件</span><br><span class="line">  |</span><br><span class="line">  |-- zh.js      //中文语言包</span><br><span class="line">  |</span><br><span class="line">  |-- zh.js      //英文语言包</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">`index.js`</span><br><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import VueI18n from &apos;vue-i18n&apos;</span><br><span class="line">import Cookies from &apos;js-cookie&apos;</span><br><span class="line">import elementEnLocale from &apos;element-ui/lib/locale/lang/en&apos; // element-ui lang</span><br><span class="line">import elementZhLocale from &apos;element-ui/lib/locale/lang/zh-CN&apos;// element-ui lang</span><br><span class="line">import enLocale from &apos;./en&apos;</span><br><span class="line">import zhLocale from &apos;./zh&apos;</span><br><span class="line"></span><br><span class="line">Vue.use(VueI18n)</span><br><span class="line"></span><br><span class="line">const messages = &#123;</span><br><span class="line">  en-US: &#123;</span><br><span class="line">    ...enLocale,</span><br><span class="line">    ...elementEnLocale</span><br><span class="line">  &#125;,</span><br><span class="line">  zh-CN: &#123;</span><br><span class="line">    ...zhLocale,</span><br><span class="line">    ...elementZhLocale</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const i18n = new VueI18n(&#123;</span><br><span class="line">  locale: Cookies.get(&apos;language&apos;) || &apos;en-US&apos;,</span><br><span class="line">  messages</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default i18n</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">`zh.js`</span><br><span class="line">  export default &#123;</span><br><span class="line">  login: &#123;</span><br><span class="line">    title: &apos;欢迎&apos;</span><br><span class="line">    logIn: &apos;登录&apos;</span><br><span class="line"> &#125;</span><br><span class="line">`en.js`</span><br><span class="line">export default &#123;</span><br><span class="line">  login: &#123;</span><br><span class="line">    title: &apos;Welcome&apos;,</span><br><span class="line">    logIn: &apos;Log in&apos;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>使用实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;&#123;&#123;$t(&apos;login.title&apos;)&#125;&#125;&lt;/span&gt;</span><br><span class="line">// 在语言代码为中文（zh-CN）时,则展示为：欢迎</span><br><span class="line">// 在语言代码为英文（en-US）时,则展示为：Welcome&apos;</span><br></pre></td></tr></table></figure></p>
<p>store文件夹：vue&amp;cookie中存入语言代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">store</span><br><span class="line">  |--index.js   //主文件</span><br><span class="line">  |</span><br><span class="line">  |-- modules      //vuex子模块文件</span><br><span class="line">          |</span><br><span class="line">          |-- language.js      //语言</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">`index.js`</span><br><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import Vuex from &apos;vuex&apos;</span><br><span class="line">import language from &apos;./modules/language&apos;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    language</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default store</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">`language.js  `</span><br><span class="line">import Cookies from &apos;js-cookie&apos;</span><br><span class="line">import Cookies from &apos;js-cookie&apos;</span><br><span class="line"></span><br><span class="line">const app = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    language: Cookies.get(&apos;language&apos;) || &apos;en-US&apos; // 项目初始化时，默认为英文</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_LANGUAGE: (state, language) =&gt; &#123;</span><br><span class="line">      state.language = language</span><br><span class="line">      Cookies.set(&apos;language&apos;, language)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    language: state =&gt; state.language</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    setLanguage(&#123; commit &#125;, language) &#123;</span><br><span class="line">      commit(&apos;SET_LANGUAGE&apos;, language)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default app</span><br></pre></td></tr></table></figure>
<p>在项目需要切换语言的位置，添加如下事件即可，（事件：将语言代码存入到vuex中，vuex中调用setcookie即可存入到cookie中,并改变i18n中的local即可切换语言。）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handleSetLanguage(lang) &#123;</span><br><span class="line">  this.$i18n.locale = lang</span><br><span class="line">  this.$store.dispatch(&apos;setLanguage&apos;, lang)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上即可实现国际化！！！！！<br>😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊😊</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/vueI18/" data-id="ckd4b4q2r0027t2p34ni8dn92" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-fixProject" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/fixProject/" class="article-date">
  <time datetime="2020-07-27T09:22:37.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/fixProject/">如何优化项目</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一些有意思的loader-和-plugins"><a href="#一些有意思的loader-和-plugins" class="headerlink" title="一些有意思的loader 和 plugins"></a>一些有意思的loader 和 plugins</h2><hr>
<h4 id="如何自动加载"><a href="#如何自动加载" class="headerlink" title="如何自动加载"></a>如何自动加载</h4><p><code>require.context</code>：根据自定的规则获取需要的内容。</p>
<blockquote>
<p>解决困扰：新增或减少页面每次需要更改路由配置？</p>
</blockquote>
<ul>
<li>以vue项目为例，实现动态配置路由。</li>
</ul>
<p>在vue的component中按照如下格式配置页面。<br><img src="https://upload-images.jianshu.io/upload_images/11846892-47016d33b4647d29.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<blockquote>
<p>mode (模块名称)</p>
<blockquote>
<p>index.routes.js (该模块下路由解析配置)<br>pages (文件统一名称)</p>
<blockquote>
<p>mode.index.vue (模块下默认页面)<br>mode.resource.vue  (模块下其他页面)</p>
</blockquote>
</blockquote>
</blockquote>
<p>在mode中的index.routes.js中配置路由解析代码,会自动生成routes<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 第1个参数： 路径</span><br><span class="line">// 第2个参数: 是否遍历1参数下面的子文件夹</span><br><span class="line">// 第3个参数： 正则匹配对应后缀的文件</span><br><span class="line"></span><br><span class="line">let r = require.context(&apos;./pages&apos;, false, /.vue/);</span><br><span class="line">// r是一个func,直接调用会报错。</span><br><span class="line">let routesArr = [];</span><br><span class="line">r.keys().forEach((key) =&gt; &#123;</span><br><span class="line">  console.log(r(key))</span><br><span class="line">  let _keyArr = key.split(&apos;.&apos;);</span><br><span class="line">  if (key.indexOf(&apos;index&apos;) != -1) &#123;</span><br><span class="line">    routesArr.push (&#123;</span><br><span class="line">      path: _keyArr[1],</span><br><span class="line">      name: _keyArr[1],</span><br><span class="line">      component: r(key).default</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    routesArr.push (&#123;</span><br><span class="line">      path: `$&#123;_keyArr[1]&#125;/$&#123;_keyArr[2]&#125;`,</span><br><span class="line">      name: _keyArr[1],</span><br><span class="line">      component: r(key).default</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">export default routesArr</span><br></pre></td></tr></table></figure></p>
<p>在总路由地址下引用各个模块下面的路由：</p>
<p>在router &gt; index.js配置如下代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let r = require.context(&apos;./components&apos;, true, /\.routes\.js/);</span><br><span class="line">let routesArr: any[] = [];</span><br><span class="line">r.keys().forEach((key) =&gt; &#123;</span><br><span class="line">  console.log(r(key));</span><br><span class="line">  routesArr = routesArr.concat(r(key).defalut);</span><br><span class="line">&#125;)</span><br><span class="line">export const routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/&quot;,</span><br><span class="line">    name: &apos;Home&apos;,</span><br><span class="line">    components:Home</span><br><span class="line">  &#125;,</span><br><span class="line">  ...routesArr</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<p>缺点：<br>  1.不能按需引入<br>  2.不能实现动态路由。<br>优点：<br>  1.规范项目结构+文件命名+路由命名<br>  2.减少配置路由的困扰</p>
<h2 id="如何优化打包"><a href="#如何优化打包" class="headerlink" title="如何优化打包"></a>如何优化打包</h2><hr>
<h4 id="Dll优化"><a href="#Dll优化" class="headerlink" title="Dll优化"></a>Dll优化</h4><p>原理： 减少处理内容和步骤<br>js - 第三方库： vue / vue-router / axios /loadsh (只压缩打包一次,缓存到静态文件中)</p>
<p>步骤： 预处理第三方库 -&gt; 打包其他文件。</p>
<ul>
<li>以vue项目为例，封装Dll优化。</li>
</ul>
<p>在vue项目的bulid文件下新建webpack.dll.js文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var path = require(&apos;path&apos;)</span><br><span class="line">var webpack = require(&apos;webpack&apos;)</span><br><span class="line">var config = require(&apos;../config&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    // 定义提前处理的文件</span><br><span class="line">    vendor: [&apos;vue/dist/vue.esm.js&apos;, &apos;vue-router&apos;]</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    // 将预处理打包好的文件资源，放在静态文件夹中。</span><br><span class="line">    path: path.join(__dirname, &apos;../static/js&apos;),</span><br><span class="line">    filename: &apos;[name].dll.js&apos;,</span><br><span class="line">    library: &apos;[name]_library&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    // 在当前目录下生成一个通知，命名为[name]_manifest.json</span><br><span class="line">    new webpack.DllPlugin(&#123;</span><br><span class="line">      path:path.join(__dirname,&apos;.&apos;, &apos;[name]-manifest.json&apos;),</span><br><span class="line">      name: &apos;[name]_library&apos; // 对应output中的library</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在package.json 的 <code>scripts</code>中配置npm run dll 命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;dll&quot;: &quot;webpack --config build/webpack.dll.js&quot;</span><br></pre></td></tr></table></figure></p>
<p>然后执行<code>npm run dll</code>命令看一下打包所需要的时间<br><img src="https://upload-images.jianshu.io/upload_images/11846892-fafb831343c335b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后在执行一下<code>npm run build</code> 命令查看一下原始打包所需要的时间<br><img src="https://upload-images.jianshu.io/upload_images/11846892-d5d9ff566fdbde19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>执行<code>npm run dll</code>命令之后会发现在<code>bulid</code>文件夹下生成了<br><code>vendor-manifest.json</code>,在<code>static/js</code>下生成了<code>vendor.dll.js</code>。<br><img src="https://upload-images.jianshu.io/upload_images/11846892-4cf356217f7b1eb0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="https://upload-images.jianshu.io/upload_images/11846892-4e1610e26c92530e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后在<code>bulid/webpack.prod.conf.js</code>中配置正常打包下的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    new webpack.DllReferencePlugin(&#123;</span><br><span class="line">      //context: 在html中引入的路径。</span><br><span class="line">      context: path.join(__dirname, &apos;..&apos;),</span><br><span class="line">      manifest: require(&apos;./vendor-manifest.json&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>最后在执行一下<code>npm run build</code> 命令查看一下dll处理之后打包所需要的时间<br><img src="https://upload-images.jianshu.io/upload_images/11846892-cd9552fdd529d347.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>很完美的节约了一些时间，时间就是金钱，时间就是生命。</p>
<h4 id="如何开发插件与loader"><a href="#如何开发插件与loader" class="headerlink" title="如何开发插件与loader"></a>如何开发插件与loader</h4><hr>
<blockquote>
<p>示例问题：项目vuex过大，导致打包结果过大。<br>处理： 按组件异步加载vuex</p>
</blockquote>
<p>在src/store文件夹下index文件中存储首屏加载的vuex数据;<br>在src/store/model/.. 文件夹下存储其他模块需要懒加载的vuex数据;<br><img src="https://upload-images.jianshu.io/upload_images/11846892-5b5262f39bc46f2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>在src下新建vuePlugins/index封装插件<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8799f362b4bdfdff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>示例代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let a = &#123;</span><br><span class="line">  install:function(vue) &#123;</span><br><span class="line">    vue.mixin(&#123;</span><br><span class="line">      beforeCreate:function()&#123;</span><br><span class="line">        if (this.$options.isVuex) &#123;</span><br><span class="line">          // 在对应页面中配置store</span><br><span class="line">          // store中存储需要按需加载的vuex相关的js文件</span><br><span class="line">          let store = this.$options.store;</span><br><span class="line">          // 动态引入vuex</span><br><span class="line">          // 注意：import的参数不能传入变量。</span><br><span class="line">          import(&apos;../store/model/&apos;+ store).then((res) =&gt; &#123;</span><br><span class="line">            // registerModul方法是vuex的方法;</span><br><span class="line">            this.$store.registerModule(store, res.default);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default a;</span><br></pre></td></tr></table></figure></p>
<p>在main.js引入插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Vuepl from &quot;./vuePlugins&quot;;</span><br><span class="line">Vue.use(Vuepl);</span><br></pre></td></tr></table></figure></p>
<p>在需要懒加载vuex的页面配置<br><img src="https://upload-images.jianshu.io/upload_images/11846892-c4e24d770a72ec58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isVuex:true;</span><br><span class="line">store: &apos;modelIndex&apos;;</span><br></pre></td></tr></table></figure></p>
<p>👌了！以上就是vuex实现按需加载的栗子。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/fixProject/" data-id="ckd4b4q1f0012t2p39wm47pmr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-axios1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/axios1/" class="article-date">
  <time datetime="2020-07-27T09:21:00.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/axios1/">Axios源码解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="axios如何实现多种请求方式"><a href="#axios如何实现多种请求方式" class="headerlink" title="axios如何实现多种请求方式"></a>axios如何实现多种请求方式</h4><hr>
<p><code>原理</code>： 通过数组循环来批量注册接口，统一调用同一个方法，参数差异：通过until.merge()方法来解决差异。类型：通过方法循环的method来区分。<br><code>实现逻辑</code>：</p>
<ol>
<li>生成axios实例；</li>
<li>通过bind方法将axios原型中的request方法指向axios实例；</li>
<li>通过extend方法将axios实例和axios的原型链合并并指向context<br>目的： 扩展axios的调用方法。使axios可以通过axios.get去调用，也可以通过原型链去调用。</li>
<li>利用通过数组循环来批量注册接口，统一调用同一个方法.<br>通过until.merge()方法来解决参数差异。</li>
</ol>
<p><code>代码示例</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">function Axios (instanceConfig) &#123;</span><br><span class="line">  this.default = instanceConfig;</span><br><span class="line">&#125;</span><br><span class="line">/** </span><br><span class="line"> * bind(&#123;&#125;, &#123;&#125;)</span><br><span class="line"> * bind:将第一个参数的指向第二个参数;</span><br><span class="line"> * extend(&#123;&#125;, &#123;&#125;)</span><br><span class="line"> * extend:将两个对象进行合并;</span><br><span class="line">*/</span><br><span class="line">function creatInstance (defaultConfig) &#123;</span><br><span class="line">  let context = new Axios(defaultConfig);</span><br><span class="line">  // 将Axios中的request方法，指向新的Axios对象</span><br><span class="line">  let instance = bind(Axios.prototype.request, context);</span><br><span class="line">  // 将前两个对象合并，合并后的this指向context</span><br><span class="line">  // 目的：扩展axios的调用方法。使axios可以通过axios.get去调用，也可以通过原型链去调用。</span><br><span class="line">  extend(instance, Axios.prototype, context);</span><br><span class="line">  return instance;</span><br><span class="line">&#125;</span><br><span class="line">// axios.get()</span><br><span class="line"></span><br><span class="line">let arr = [&apos;get&apos;, &apos;post&apos;, &apos;push &apos; ,&apos;delete&apos;];</span><br><span class="line"></span><br><span class="line">arr.forEach((method) =&gt; &#123;</span><br><span class="line">  // 循环在原型链上注册请求方法。</span><br><span class="line">  Axios.prototype[method] = function(url,config)&#123;</span><br><span class="line">    // config :post的data,</span><br><span class="line">    // util.merge :axios中的一个方法，原理对象合并</span><br><span class="line">    return this.request(util.merge(config || &#123;&#125;, &#123;</span><br><span class="line">        methods: method,</span><br><span class="line">        url: url</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="axios如何实现请求拦截"><a href="#axios如何实现请求拦截" class="headerlink" title="axios如何实现请求拦截"></a>axios如何实现请求拦截</h4><hr>
<p><code>实现逻辑</code>：</p>
<ol>
<li>在axios中配置拦截器 <code>interceptors</code>，拦截器包含request属性，和response属性，两个属性对应拦截器管理方法interceptorsManner。</li>
<li>interceptorsManner方法中配置handler属性，handler属性用于存放use加入的方法。</li>
<li>在interceptorsManner的原型上配置use方法，user方法将参数fulilled, rejected两个方法存入对象中并存入到handler中。</li>
<li>在axios的原型的request方法中注册数组chain  =  [‘dispatchRequest’, undefined];<br>其中：request 会通过dispatchRequest将请求发送出去；<br>4.1 循环interceptors.request.handler将用户存入的请求拦截的两个参数方法通过unshift分别存放到数组中。<br>4.2 循环interceptors.response.handler将用户存入的响应拦截的两个参数方法通过shift分别存放到数组中。<br>4.3 注册promise = Promise.resolve()；<br>4.4 循环chain，通过promise执行chain数组中的方法。<br><code>示例代码</code>：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">function Axios (instanceConfig) &#123;</span><br><span class="line">  this.default = instanceConfig;</span><br><span class="line">  this.interceptors=&#123;</span><br><span class="line">    request: new interceptorsManner(),</span><br><span class="line">    response: new interceptorsManner(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Axios.prototype.request = function()&#123;</span><br><span class="line">  // request 会通过dispatchRequest将请求发送出去</span><br><span class="line">  let chain = [&apos;dispatchRequest&apos;, undefined];</span><br><span class="line">  let promise = Promise.resolve();</span><br><span class="line">  this.interceptors.request.handler.forEach((interceptor) =&gt; &#123;</span><br><span class="line">    chain.unshift(interceptor.fulilled, interceptor.rejected)</span><br><span class="line">  &#125;)</span><br><span class="line">  this.interceptors.response.handler.forEach((interceptor) =&gt; &#123;</span><br><span class="line">    chain.unshift(interceptor.fulilled, interceptor.rejected)</span><br><span class="line">  // chain = [console.log(1), console.log(2),dispatchRequest,undefined, console.log(3), console.log(4)]</span><br><span class="line">  &#125;)</span><br><span class="line">  while(chain.length) &#123;</span><br><span class="line">    promise = promise.then(chain.shift(), chain.shift())</span><br><span class="line">    // 举例</span><br><span class="line">    // 第一次循环执行请求拦截前的成功和失败方法</span><br><span class="line">    // 第二次循环执行发送请求和undefined;</span><br><span class="line">    // 第一次循环执行响应拦截前的成功和失败方法</span><br><span class="line">  &#125;</span><br><span class="line">  // 依次执行，并保证上一个方法完成之后在继续执行下一个方法。</span><br><span class="line">&#125;;</span><br><span class="line">function interceptorsManner () &#123;</span><br><span class="line">  this.handler= []; //存放use加入的方法</span><br><span class="line">&#125;</span><br><span class="line">interceptorsManner.prototype.use = function use(fulilled, rejected) &#123;</span><br><span class="line">  this.handler.push(&#123;</span><br><span class="line">    fulilled:  fulilled,</span><br><span class="line">    rejected: rejected</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">//请求拦截器&amp;响应拦截器的使用方法</span><br><span class="line">Axios.interceptors.request.use(function()&#123;</span><br><span class="line"></span><br><span class="line">&#125;,function()&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">Axios.interceptors.response.use(function()&#123;</span><br><span class="line"></span><br><span class="line">&#125;,function()&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>完美！！！！！！！！！！！！！！！！！！！！！！！！！！！<br>接下来你可能想要了解的：<br><a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener">axios文档地址</a><br><a href="https://www.jianshu.com/p/7f7b655bd3c4" target="_blank" rel="noopener">Axios封装示例代码+封装思路</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/axios1/" data-id="ckd4b4q1i0015t2p3x2zf8jhq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-reactCom2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/reactCom2/" class="article-date">
  <time datetime="2020-07-27T09:17:30.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/reactCom2/">使用react搭建组件库--radio组件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>####前言<br>你应该需要：<a href="[https://www.jianshu.com/p/8ef96e06adcc](https://www.jianshu.com/p/8ef96e06adcc">使用react搭建组件库：react+typescript+storybook</a><br>)</p>
<p>##1. 安装依赖<br>在组件中使用 <code>rc-checkbox</code>： <a href="https://www.npmjs.com/package/rc-checkbox" target="_blank" rel="noopener">react rc-checkbox component</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install rc-checkbox</span><br></pre></td></tr></table></figure>
<p>##2. 编写组件</p>
<ul>
<li><p>新建 <code>src/components/Radio/radio.tsx</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import RcCheckbox from &apos;rc-checkbox&apos;;</span><br><span class="line">import classNames from &apos;classnames&apos;;</span><br><span class="line">import &#123; RadioProps, RadioChangeEvent &#125; from &apos;./interface&apos;;</span><br><span class="line">import &#123; ConfigContext &#125; from &apos;../config-provider&apos;;</span><br><span class="line">import RadioGroupContext from &apos;./context&apos;;</span><br><span class="line">import &#123; composeRef &#125; from &apos;../_util/ref&apos;;</span><br><span class="line">const InternalRadio: React.ForwardRefRenderFunction&lt;unknown, RadioProps&gt; = (props, ref) =&gt; &#123;</span><br><span class="line">  const context = React.useContext(RadioGroupContext);</span><br><span class="line">  const &#123; getPrefixCls, direction &#125; = React.useContext(ConfigContext);</span><br><span class="line">  const innerRef = React.useRef&lt;HTMLElement&gt;();</span><br><span class="line">  const mergedRef = composeRef(ref, innerRef);</span><br><span class="line">  </span><br><span class="line">  const onChange = (e: RadioChangeEvent) =&gt; &#123;</span><br><span class="line">    if (props.onChange) &#123;</span><br><span class="line">      props.onChange(e);</span><br><span class="line">    &#125;</span><br><span class="line">    if (context?.onChange) &#123;</span><br><span class="line">      context.onChange(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const &#123; prefixCls: customizePrefixCls, className, children, style, ...restProps &#125; = props;</span><br><span class="line">  const prefixCls = getPrefixCls(&apos;radio&apos;, customizePrefixCls);</span><br><span class="line">  console.log(prefixCls, customizePrefixCls)</span><br><span class="line">  const radioProps: RadioProps = &#123; ...restProps &#125;;</span><br><span class="line">  if (context) &#123;</span><br><span class="line">    radioProps.name = context.name;</span><br><span class="line">    radioProps.onChange = onChange;</span><br><span class="line">    radioProps.checked = props.value === context.value;</span><br><span class="line">    radioProps.disabled = props.disabled || context.disabled;</span><br><span class="line">  &#125;</span><br><span class="line">  const wrapperClassString = classNames(className, &#123;</span><br><span class="line">    [`$&#123;prefixCls&#125;-wrapper`]: true,</span><br><span class="line">    [`$&#123;prefixCls&#125;-wrapper-checked`]: radioProps.checked,</span><br><span class="line">    [`$&#123;prefixCls&#125;-wrapper-disabled`]: radioProps.disabled,</span><br><span class="line">    [`$&#123;prefixCls&#125;-wrapper-rtl`]: direction === &apos;rtl&apos;,</span><br><span class="line">  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;label</span><br><span class="line">      className=&#123;wrapperClassString&#125;</span><br><span class="line">      style=&#123;style&#125;</span><br><span class="line">      onMouseEnter=&#123;props.onMouseEnter&#125;</span><br><span class="line">      onMouseLeave=&#123;props.onMouseLeave&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;RcCheckbox &#123;...radioProps&#125; prefixCls=&#123;prefixCls as string&#125; ref=&#123;mergedRef as any&#125; /&gt;</span><br><span class="line">      &#123;children !== undefined ? &lt;span&gt;&#123;children&#125;&lt;/span&gt; : null&#125;</span><br><span class="line">    &lt;/label&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">const Radio = React.forwardRef&lt;unknown, RadioProps&gt;(InternalRadio);</span><br><span class="line">Radio.displayName = &apos;Radio&apos;;</span><br><span class="line"></span><br><span class="line">Radio.defaultProps = &#123;</span><br><span class="line">  type: &apos;radio&apos;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Radio;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Radio/interface.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">export interface AbstractCheckboxProps&lt;T&gt; &#123;</span><br><span class="line">  prefixCls?: string;</span><br><span class="line">  className?: string;</span><br><span class="line">  defaultChecked?: boolean;</span><br><span class="line">  checked?: boolean;</span><br><span class="line">  style?: React.CSSProperties;</span><br><span class="line">  disabled?: boolean;</span><br><span class="line">  onChange?: (e: T) =&gt; void;</span><br><span class="line">  onClick?: React.MouseEventHandler&lt;HTMLElement&gt;;</span><br><span class="line">  onMouseEnter?: React.MouseEventHandler&lt;HTMLElement&gt;;</span><br><span class="line">  onMouseLeave?: React.MouseEventHandler&lt;HTMLElement&gt;;</span><br><span class="line">  onKeyPress?: React.KeyboardEventHandler&lt;HTMLElement&gt;;</span><br><span class="line">  onKeyDown?: React.KeyboardEventHandler&lt;HTMLElement&gt;;</span><br><span class="line">  value?: any;</span><br><span class="line">  tabIndex?: number;</span><br><span class="line">  name?: string;</span><br><span class="line">  children?: React.ReactNode;</span><br><span class="line">  id?: string;</span><br><span class="line">  autoFocus?: boolean;</span><br><span class="line">  type?: string;</span><br><span class="line">&#125;</span><br><span class="line">export type RadioProps = AbstractCheckboxProps&lt;RadioChangeEvent&gt;;</span><br><span class="line">export interface RadioChangeEventTarget extends RadioProps &#123;</span><br><span class="line">  checked: boolean;</span><br><span class="line">&#125;</span><br><span class="line">export interface RadioChangeEvent &#123;</span><br><span class="line">  target: RadioChangeEventTarget;</span><br><span class="line">  stopPropagation: () =&gt; void;</span><br><span class="line">  preventDefault: () =&gt; void;</span><br><span class="line">  nativeEvent: MouseEvent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface RadioGroupContextProps &#123;</span><br><span class="line">  onChange: (e: RadioChangeEvent) =&gt; void;</span><br><span class="line">  value: any;</span><br><span class="line">  disabled?: boolean;</span><br><span class="line">  name?: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/config-provider/context.tsx: 为组件库提供共享状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">export interface ConfigConsumerProps &#123;</span><br><span class="line">  getPrefixCls: (suffixCls: string, customizePrefixCls?: string) =&gt; string;</span><br><span class="line">  direction?: &apos;ltr&apos; | &apos;rtl&apos;;</span><br><span class="line">&#125;</span><br><span class="line">export const ConfigContext = React.createContext&lt;ConfigConsumerProps&gt;(&#123;</span><br><span class="line">  // We provide a default function for Context without provider</span><br><span class="line">  getPrefixCls: (suffixCls: string, customizePrefixCls?: string) =&gt; &#123;</span><br><span class="line">    if (customizePrefixCls) return customizePrefixCls;</span><br><span class="line"></span><br><span class="line">    return suffixCls ? `echo-$&#123;suffixCls&#125;` : &apos;echo&apos;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export const ConfigConsumer = ConfigContext.Consumer;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/config-provider/index.tsx: 为组件库提供共享状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ConfigContext, ConfigConsumer &#125; from &apos;./context&apos;;</span><br><span class="line">export &#123; ConfigContext, ConfigConsumer&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/config-provider/SizeContext.tsx: 为组件库提供大小共享状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">export type SizeType = &apos;small&apos; | &apos;middle&apos; | &apos;large&apos; | undefined;</span><br><span class="line">const SizeContext = React.createContext&lt;SizeType&gt;(undefined);</span><br><span class="line">export default SizeContext;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Radio/context.tsx: 为Radio相关组件提供共享状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import &#123; RadioGroupContextProps &#125; from &apos;./interface&apos;;</span><br><span class="line">const RadioGroupContext = React.createContext&lt;RadioGroupContextProps | null&gt;(null);</span><br><span class="line">export const RadioGroupContextProvider = RadioGroupContext.Provider;</span><br><span class="line">export default RadioGroupContext;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/_util/ref.tsx:组件库通用方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">export function fillRef&lt;T&gt;(ref: React.Ref&lt;T&gt;, node: T) &#123;</span><br><span class="line">  if (typeof ref === &apos;function&apos;) &#123;</span><br><span class="line">    ref(node);</span><br><span class="line">  &#125; else if (typeof ref === &apos;object&apos; &amp;&amp; ref &amp;&amp; &apos;current&apos; in ref) &#123;</span><br><span class="line">    (ref as any).current = node;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function composeRef&lt;T&gt;(...refs: React.Ref&lt;T&gt;[]): React.Ref&lt;T&gt; &#123;</span><br><span class="line">  return (node: T) =&gt; &#123;</span><br><span class="line">    refs.forEach(ref =&gt; &#123;</span><br><span class="line">      fillRef(ref, node);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Radio/index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Radio from &quot;./radio&quot;;</span><br><span class="line">export default Radio;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Radio/_rtl.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../styles/variables/radio&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$radio-prefix-cls: &apos;echo-radio&apos;;</span><br><span class="line">$radio-group-prefix-cls: &apos;#&#123;$radio-prefix-cls&#125;-group&apos;;</span><br><span class="line">$radio-prefix-cls-button-wrapper: &apos;#&#123;$radio-prefix-cls&#125;-button-wrapper&apos;;</span><br><span class="line">.#&#123;$radio-group-prefix-cls&#125;&#123;</span><br><span class="line">  &amp;-rtl &#123;</span><br><span class="line">    direction: rtl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 一般状态</span><br><span class="line">.#&#123;$radio-prefix-cls&#125;-wrapper &#123;</span><br><span class="line">  &amp;-rtl &#123;</span><br><span class="line">    margin-right: 0;</span><br><span class="line">    margin-left: $radio-wrapper-margin-right;</span><br><span class="line">    direction: rtl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.#&#123;$radio-prefix-cls-button-wrapper&#125; &#123;</span><br><span class="line">  &amp;-rtl &#123;</span><br><span class="line">    border-right-width: 0;</span><br><span class="line">    border-left-width: $border-width-base;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:not(:first-child) &#123;</span><br><span class="line">    &amp;::before &#123;</span><br><span class="line">      .#&#123;$radio-prefix-cls-button-wrapper&#125;.#&#123;$radio-prefix-cls-button-wrapper&#125;-rtl &amp; &#123;</span><br><span class="line">        right: -1px;</span><br><span class="line">        left: 0;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:first-child &#123;</span><br><span class="line">    .#&#123;$radio-prefix-cls-button-wrapper&#125;.#&#123;$radio-prefix-cls-button-wrapper&#125;-rtl &amp; &#123;</span><br><span class="line">      border-right: $border-width-base $border-style-base $border-color-base;</span><br><span class="line">      border-radius: 0 $border-radius-base $border-radius-base 0;</span><br><span class="line">    &#125;</span><br><span class="line">    .#&#123;$radio-prefix-cls-button-wrapper&#125;-checked:not([class*=&quot;&apos;#&#123;$radio-prefix-cls&#125;-button-wrapper-disabled&apos;&quot;]) &amp; &#123;</span><br><span class="line">      border-right-color:lighten($primary, 10%);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:last-child &#123;</span><br><span class="line">    .#&#123;$radio-prefix-cls-button-wrapper&#125;.#&#123;$radio-prefix-cls-button-wrapper&#125;-rtl &amp; &#123;</span><br><span class="line">      border-radius: $border-radius-base 0 0 $border-radius-base;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-disabled &#123;</span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      .#&#123;$radio-prefix-cls-button-wrapper&#125;.#&#123;$radio-prefix-cls-button-wrapper&#125;-rtl &amp; &#123;</span><br><span class="line">        border-right-color: $border-color-base;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Icon/_style.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../styles/variables/radio&quot;;</span><br><span class="line">@import &quot;./rtl&quot;;</span><br><span class="line"></span><br><span class="line">$radio-prefix-cls: &apos;echo-radio&apos;;</span><br><span class="line">$radio-group-prefix-cls: &apos;#&#123;$radio-prefix-cls&#125;-group&apos;;</span><br><span class="line">$radio-inner-prefix-cls: &apos;#&#123;radio-prefix-cls&#125;-inner&apos;;</span><br><span class="line">$radio-duration: 0.3s;</span><br><span class="line">$radio-focus-shadow: 0 0 0 3px fade($primary, 8%);</span><br><span class="line">$radio-button-focus-shadow: $radio-focus-shadow;</span><br><span class="line"></span><br><span class="line">.#&#123;$radio-group-prefix-cls&#125; &#123;</span><br><span class="line">  @include reset-component;</span><br><span class="line"></span><br><span class="line">  display: inline-block;</span><br><span class="line">  font-size: 0;</span><br><span class="line">  line-height: unset;</span><br><span class="line"></span><br><span class="line">  .echo-badge-count &#123;</span><br><span class="line">    z-index: 1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .echo-badge:not(:first-child) .#&#123;$radio-prefix-cls&#125;-button-wrapper &#123;</span><br><span class="line">    border-left: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 一般状态</span><br><span class="line">.#&#123;$radio-prefix-cls&#125;-wrapper &#123;</span><br><span class="line">  @include reset-component;</span><br><span class="line"></span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  margin-right: $radio-wrapper-margin-right;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.#&#123;$radio-prefix-cls&#125; &#123;</span><br><span class="line">  @include reset-component;</span><br><span class="line"></span><br><span class="line">  position: relative;</span><br><span class="line">  top: -3px;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  line-height: 1;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  vertical-align: sub;</span><br><span class="line">  outline: none;</span><br><span class="line">  cursor: pointer;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-prefix-cls&#125;-wrapper:hover &amp;,</span><br><span class="line">  &amp;:hover .#&#123;$radio-inner-prefix-cls&#125;,</span><br><span class="line">  &amp;-input:focus + .#&#123;$radio-inner-prefix-cls&#125; &#123;</span><br><span class="line">    border-color: $radio-dot-color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-input:focus + .#&#123;$radio-inner-prefix-cls&#125; &#123;</span><br><span class="line">    box-shadow: $radio-focus-shadow;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-checked::after &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    border: 1px solid $radio-dot-color;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    visibility: hidden;</span><br><span class="line">    animation: antRadioEffect 0.36s ease-in-out;</span><br><span class="line">    animation-fill-mode: both;</span><br><span class="line">    content: &apos;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:hover::after,</span><br><span class="line">  .#&#123;$radio-prefix-cls&#125;-wrapper:hover &amp;::after &#123;</span><br><span class="line">    visibility: visible;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-inner &#123;</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">      $radio-dot-size: $radio-size - 8px;</span><br><span class="line"></span><br><span class="line">      position: absolute;</span><br><span class="line">      top: ($radio-size - $radio-dot-size) / 2 - 1px;</span><br><span class="line">      left: ($radio-size - $radio-dot-size) / 2 - 1px;</span><br><span class="line">      display: table;</span><br><span class="line">      width: $radio-dot-size;</span><br><span class="line">      height: $radio-dot-size;</span><br><span class="line">      background-color: $radio-dot-color;</span><br><span class="line">      border-top: 0;</span><br><span class="line">      border-left: 0;</span><br><span class="line">      border-radius: $radio-dot-size;</span><br><span class="line">      transform: scale(0);</span><br><span class="line">      opacity: 0;</span><br><span class="line">      transition: all $radio-duration $ease-in-out-circ;</span><br><span class="line">      content: &apos; &apos;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 选中状态</span><br><span class="line">.#&#123;$radio-prefix-cls&#125;-checked &#123;</span><br><span class="line">  .#&#123;$radio-inner-prefix-cls&#125; &#123;</span><br><span class="line">    border-color: $radio-dot-color;</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">      transform: scale(1);</span><br><span class="line">      opacity: 1;</span><br><span class="line">      transition: all $radio-duration $ease-in-out-circ;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.#&#123;$radio-prefix-cls&#125;-disabled &#123;</span><br><span class="line">  .#&#123;$radio-inner-prefix-cls&#125; &#123;</span><br><span class="line">    background-color: $disabled-color;</span><br><span class="line">    border-color: $border-color-base !important;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">      background-color: $radio-dot-disabled-color;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-prefix-cls&#125;-input &#123;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp; + span &#123;</span><br><span class="line">    color: $disabled-color;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">span.#&#123;$radio-prefix-cls&#125; + * &#123;</span><br><span class="line">  padding-right: 8px;</span><br><span class="line">  padding-left: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.#&#123;$radio-prefix-cls&#125;-button-wrapper &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  height: $height-base;</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0 $padding-md - 1px;</span><br><span class="line">  color: $radio-button-color;</span><br><span class="line">  font-size: $font-size-base;</span><br><span class="line">  line-height: $height-base - 2px;</span><br><span class="line">  background: $radio-button-bg;</span><br><span class="line">  border: $border-width-base $border-style-base $border-color-base;</span><br><span class="line">  // strange align fix for chrome but works</span><br><span class="line">  // https://gw.alipayobjects.com/zos/rmsportal/VFTfKXJuogBAXcvfAUWJ.gif</span><br><span class="line">  border-top-width: $border-width-base + 0.02px;</span><br><span class="line">  border-left-width: 0;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  transition: color 0.3s, background 0.3s, border-color 0.3s, box-shadow 0.3s;</span><br><span class="line"></span><br><span class="line">  a &#123;</span><br><span class="line">    color: $radio-button-color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &gt; .#&#123;$radio-prefix-cls&#125;-button &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    width: 0;</span><br><span class="line">    height: 0;</span><br><span class="line">    margin-left: 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-group-prefix-cls&#125;-large &amp; &#123;</span><br><span class="line">    height: $height-lg;</span><br><span class="line">    font-size: $font-size-lg;</span><br><span class="line">    line-height: $height-lg - 2px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-group-prefix-cls&#125;-small &amp; &#123;</span><br><span class="line">    height: $height-sm;</span><br><span class="line">    padding: 0 $control-padding-horizontal-sm - 1px;</span><br><span class="line">    line-height: $height-sm - 2px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:not(:first-child) &#123;</span><br><span class="line">    &amp;::before &#123;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: $border-width-base * -1;</span><br><span class="line">      left: -1px;</span><br><span class="line">      display: block;</span><br><span class="line">      box-sizing: content-box;</span><br><span class="line">      width: 1px;</span><br><span class="line">      height: 100%;</span><br><span class="line">      padding: $border-width-base 0;</span><br><span class="line">      background-color: $border-color-base;</span><br><span class="line">      transition: background-color 0.3s;</span><br><span class="line">      content: &apos;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:first-child &#123;</span><br><span class="line">    border-left: $border-width-base $border-style-base $border-color-base;</span><br><span class="line">    border-radius: $border-radius-base 0 0 $border-radius-base;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:last-child &#123;</span><br><span class="line">    border-radius: 0 $border-radius-base $border-radius-base 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:first-child:last-child &#123;</span><br><span class="line">    border-radius: $border-radius-base;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    color: $radio-dot-color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;:focus-within &#123;</span><br><span class="line">    box-shadow: $radio-button-focus-shadow;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-prefix-cls&#125;-inner,</span><br><span class="line">  input[type=&apos;checkbox&apos;],</span><br><span class="line">  input[type=&apos;radio&apos;] &#123;</span><br><span class="line">    width: 0;</span><br><span class="line">    height: 0;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-checked:not(&amp;-disabled) &#123;</span><br><span class="line">    z-index: 1;</span><br><span class="line">    color: $radio-dot-color;</span><br><span class="line">    background: $radio-button-checked-bg;</span><br><span class="line">    border-color: $radio-dot-color;</span><br><span class="line"></span><br><span class="line">    &amp;::before &#123;</span><br><span class="line">      background-color: $radio-dot-color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      border-color: $radio-dot-color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      color: $radio-button-hover-color;</span><br><span class="line">      border-color: $radio-button-hover-color;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        background-color: $radio-button-hover-color;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;:active &#123;</span><br><span class="line">      color: $radio-button-active-color;</span><br><span class="line">      border-color: $radio-button-active-color;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        background-color: $radio-button-active-color;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;:focus-within &#123;</span><br><span class="line">      box-shadow: $radio-button-focus-shadow;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .#&#123;$radio-group-prefix-cls&#125;-solid &amp;-checked:not(&amp;-disabled) &#123;</span><br><span class="line">    color: $radio-solid-checked-color;</span><br><span class="line">    background: $radio-dot-color;</span><br><span class="line">    border-color: $radio-dot-color;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      color: $radio-solid-checked-color;</span><br><span class="line">      background: $radio-button-hover-color;</span><br><span class="line">      border-color: $radio-button-hover-color;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:active &#123;</span><br><span class="line">      color: $radio-solid-checked-color;</span><br><span class="line">      background: $radio-button-active-color;</span><br><span class="line">      border-color: $radio-button-active-color;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:focus-within &#123;</span><br><span class="line">      box-shadow: $radio-button-focus-shadow;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-disabled &#123;</span><br><span class="line">    color: $disabled-color;</span><br><span class="line">    background-color: $disabled-bg;;</span><br><span class="line">    border-color: $border-color-base;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line"></span><br><span class="line">    &amp;:first-child,</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      color: $disabled-color;</span><br><span class="line">      background-color: $disabled-bg;;</span><br><span class="line">      border-color: $border-color-base;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      border-left-color: $border-color-base;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-disabled &amp;-checked &#123;</span><br><span class="line">    color: $radio-disabled-button-checked-color;</span><br><span class="line">    background-color: $radio-disabled-button-checked-bg;</span><br><span class="line">    border-color: $border-color-base;</span><br><span class="line">    box-shadow: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes antRadioEffect &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    transform: scale(1);</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    transform: scale(1.6);</span><br><span class="line">    opacity: 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Firefox hack</span><br><span class="line">@supports (-moz-appearance: meterbar) and (background-blend-mode: difference, normal) &#123;</span><br><span class="line">  .#&#123;$radio-prefix-cls&#125; &#123;</span><br><span class="line">    vertical-align: text-bottom;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 styles/variables/_radio.scss文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;./common&quot;;</span><br><span class="line">// $font-size-base</span><br><span class="line">$radio-wrapper-margin-right: 8px;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/styles/index.scss文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// radio样式</span><br><span class="line">@import &quot;../components/Radio/style&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来<a href="https://www.jianshu.com/p/1e262b487f26" target="_blank" rel="noopener">[Typescript] 为第三方库添加声明文件 .d.ts</a></p>
</li>
<li><p>新建src/typings/index.d.ts文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference path=&quot;custom-typings.d.ts&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建src/typings/custom-typings.d.ts文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare module &apos;rc-checkbox&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改App.tsx文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 增加</span><br><span class="line">import Radio from &quot;./components/Radio/radio&quot;;</span><br><span class="line">&lt;Radio name=&quot;111&quot;&gt;Radio&lt;/Radio&gt;</span><br><span class="line">&lt;Radio name=&quot;111&quot; disabled=&#123;true&#125;&gt;Radio2&lt;/Radio&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改index.tsx文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; default as Radio &#125; from &quot;./components/Radio&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-运行项目"><a href="#3-运行项目" class="headerlink" title="3. 运行项目"></a>3. 运行项目</h2><p> 执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure></p>
<p>访问项目 可以看到Radio组件成功了！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-7fc5a5e3af91ee81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##4. 单元测试<br>新建src/Radio/radio.test.tsx文件·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; mount, render &#125; from &apos;enzyme&apos;;</span><br><span class="line">import Radio, &#123; Group, Button &#125; from &apos;..&apos;;</span><br><span class="line">import focusTest from &apos;../../../tests/shared/focusTest&apos;;</span><br><span class="line">import mountTest from &apos;../../../tests/shared/mountTest&apos;;</span><br><span class="line">import rtlTest from &apos;../../../tests/shared/rtlTest&apos;;</span><br><span class="line"></span><br><span class="line">describe(&apos;Radio&apos;, () =&gt; &#123;</span><br><span class="line">  focusTest(Radio, &#123; refFocus: true &#125;);</span><br><span class="line">  mountTest(Radio);</span><br><span class="line">  mountTest(Group);</span><br><span class="line">  mountTest(Button);</span><br><span class="line"></span><br><span class="line">  rtlTest(Radio);</span><br><span class="line">  rtlTest(Group);</span><br><span class="line">  rtlTest(Button);</span><br><span class="line"></span><br><span class="line">  it(&apos;should render correctly&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = render(&lt;Radio className=&quot;customized&quot;&gt;Test&lt;/Radio&gt;);</span><br><span class="line">    expect(wrapper).toMatchSnapshot();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&apos;responses hover events&apos;, () =&gt; &#123;</span><br><span class="line">    const onMouseEnter = jest.fn();</span><br><span class="line">    const onMouseLeave = jest.fn();</span><br><span class="line"></span><br><span class="line">    const wrapper = mount(&lt;Radio onMouseEnter=&#123;onMouseEnter&#125; onMouseLeave=&#123;onMouseLeave&#125; /&gt;);</span><br><span class="line"></span><br><span class="line">    wrapper.find(&apos;label&apos;).simulate(&apos;mouseenter&apos;);</span><br><span class="line">    expect(onMouseEnter).toHaveBeenCalled();</span><br><span class="line"></span><br><span class="line">    wrapper.find(&apos;label&apos;).simulate(&apos;mouseleave&apos;);</span><br><span class="line">    expect(onMouseLeave).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm test</span><br></pre></td></tr></table></figure></p>
<p>可以看到单元测试成功通过！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-44fe42fa111d9409.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##5.编写storybook文档</p>
<ul>
<li><p>新建<code>src/Radio/radio.stories.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; storiesOf &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123; action &#125; from &apos;@storybook/addon-actions&apos;;</span><br><span class="line"></span><br><span class="line">import Radio from &apos;./radio&apos;</span><br><span class="line"></span><br><span class="line">const defaultRadio = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Radio onClick=&#123;action(&apos;default Radio&apos;)&#125;&gt;default radio&lt;/Radio&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const radioWithDisabled = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Radio onClick=&#123;action(&apos;disabled radio&apos;)&#125;   disabled=&#123;true&#125;&gt;disabled radio&lt;/Radio&gt;</span><br><span class="line">        &lt;Radio onClick=&#123;action(&apos;unDisabled radio&apos;)&#125;  &gt;unDisabled radio&lt;/Radio&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">storiesOf(&apos;Radio 按钮&apos;, module)</span><br><span class="line">    .addParameters(&#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">            text: `</span><br><span class="line">        ## 引用方法</span><br><span class="line">        ~~~js</span><br><span class="line">        import &#123;Radio&#125; from &apos;echo-rui</span><br><span class="line">        ~~~</span><br><span class="line">        `</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .add(&apos;默认 Radio&apos;, defaultRadio)</span><br><span class="line">    .add(&apos;禁用的 Radio&apos;,radioWithDisabled)</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run storybook</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>浏览器打开<a href="http://localhost:9009/,可以看到组件库文档生成了。" target="_blank" rel="noopener">http://localhost:9009/,可以看到组件库文档生成了。</a><br><img src="https://upload-images.jianshu.io/upload_images/11846892-88eb962e94583778.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##5. 发布到npm<br> ✅ ✅ ✅ ✅ ✅</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/reactCom2/" data-id="ckd4b4q2l001zt2p3sh193kvd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-reactCom1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/reactCom1/" class="article-date">
  <time datetime="2020-07-27T09:16:46.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/reactCom1/">使用react搭建组件库--icon组件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>####前言<br>你应该需要：<a href="[https://www.jianshu.com/p/8ef96e06adcc](https://www.jianshu.com/p/8ef96e06adcc">使用react搭建组件库：react+typescript+storybook</a><br>)</p>
<p>##1. 安装依赖<br>在组件中使用 <code>fortawesome</code>： <a href="http://www.fontawesome.com.cn" target="_blank" rel="noopener">一套绝佳的图标字体库和CSS框架</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @fortawesome/fontawesome-svg-core</span><br><span class="line">npm install @fortawesome/free-solid-svg-icons</span><br><span class="line">npm install @fortawesome/react-fontawesome</span><br></pre></td></tr></table></figure>
<p>##2. 编写组件</p>
<ul>
<li><p>新建 <code>src/components/Icon/icon.tsx</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; FC &#125; from &quot;react&quot;;</span><br><span class="line">import classnames from &quot;classnames&quot;;</span><br><span class="line">import &#123; library &#125; from &quot;@fortawesome/fontawesome-svg-core&quot;;</span><br><span class="line">import &#123; fas &#125; from &quot;@fortawesome/free-solid-svg-icons&quot;;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  FontAwesomeIconProps,</span><br><span class="line">  FontAwesomeIcon,</span><br><span class="line">&#125; from &quot;@fortawesome/react-fontawesome&quot;;</span><br><span class="line"></span><br><span class="line">library.add(fas);</span><br><span class="line"></span><br><span class="line">export type theme = </span><br><span class="line">| &quot;primary&quot;</span><br><span class="line">| &quot;secondary&quot;</span><br><span class="line">| &quot;success&quot;</span><br><span class="line">| &quot;info&quot;</span><br><span class="line">| &quot;warning&quot;</span><br><span class="line">| &quot;danger&quot;</span><br><span class="line">| &quot;light&quot;</span><br><span class="line">| &quot;dark&quot;;</span><br><span class="line"></span><br><span class="line">export interface IconProps extends FontAwesomeIconProps &#123;</span><br><span class="line">  /** 主题颜色 */</span><br><span class="line">  theme?: theme;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const Icon: FC&lt;IconProps&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123; className, theme, ...restProps &#125; = props;</span><br><span class="line">  const classes = classnames(&quot;lin-icon&quot;, className, &#123;</span><br><span class="line">    [`lin-icon-$&#123;theme&#125;`]: theme,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return &lt;FontAwesomeIcon className=&#123;classes&#125; &#123;...restProps&#125; /&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Icon;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Icon/index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Icon from &quot;./icon&quot;;</span><br><span class="line"></span><br><span class="line">export default Icon;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/components/Icon/_style.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../styles/variables/icon&quot;;</span><br><span class="line">// 循环</span><br><span class="line">@each $key, $val in $icon-theme-color &#123;</span><br><span class="line">  .lin-icon-#&#123;$key&#125; &#123;</span><br><span class="line">    color: $val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 styles/variables/_icon.scss文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;./common&quot;;</span><br><span class="line"></span><br><span class="line">$icon-theme-color: (</span><br><span class="line">  &quot;primary&quot;: $primary,</span><br><span class="line">  &quot;secondary&quot;: $secondary,</span><br><span class="line">  &quot;success&quot;: $success,</span><br><span class="line">  &quot;info&quot;: $info,</span><br><span class="line">  &quot;warning&quot;: $warning,</span><br><span class="line">  &quot;danger&quot;: $danger,</span><br><span class="line">  &quot;light&quot;: $light,</span><br><span class="line">  &quot;dark&quot;: $dark,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 src/styles/index.scss文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// icon样式</span><br><span class="line">@import &quot;../components/Icon/style&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改App.tsx文件<br>！！ 对于<code>fortawesome</code>： [一套绝佳的图标字体库和CSS框架]中的图标都可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 增加</span><br><span class="line">import Icon from &quot;./components/Icon/icon&quot;;</span><br><span class="line">&lt;Icon icon=&quot;coffee&quot; size=&quot;5x&quot; theme=&quot;danger&quot; /&gt;</span><br><span class="line">&lt;Icon icon=&quot;arrow-down&quot; size=&quot;5x&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改index.tsx文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; default as Icon &#125; from &quot;./components/Icon&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-运行项目"><a href="#3-运行项目" class="headerlink" title="3. 运行项目"></a>3. 运行项目</h2><p> 执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure></p>
<p>访问项目 可以看到Icon组件成功了！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8c703c6cd972d3e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##4.编写storybook文档</p>
<ul>
<li><p>新建<code>src/Icon/icon.stories.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">import &#123; storiesOf &#125; from &apos;@storybook/react&apos;</span><br><span class="line"></span><br><span class="line">import Icon from &apos;./icon&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const defaultIcon = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;check&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;times&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;anchor&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;trash&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const iconWithTheme = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;check&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                theme=&quot;success&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;times&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                theme=&quot;danger&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;anchor&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                theme=&quot;primary&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;exclamation-circle&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                theme=&quot;warning&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const iconWithOther = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;spinner&quot;</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                spin</span><br><span class="line">                theme=&quot;primary&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">                icon=&quot;spinner&quot;</span><br><span class="line">                pulse</span><br><span class="line">                size=&quot;3x&quot;</span><br><span class="line">                theme=&quot;success&quot;</span><br><span class="line">                className=&apos;ml-20&apos;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">storiesOf(&apos;Icon 组件&apos;, module)</span><br><span class="line">    .addParameters(&#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">            text: `</span><br><span class="line">            ## 引用方法</span><br><span class="line">            ~~~js</span><br><span class="line">            import &#123;Icon&#125; from &apos;lin-react-ui</span><br><span class="line">            ~~~</span><br><span class="line">            `</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .add(&apos;默认的 Icon&apos;, defaultIcon)</span><br><span class="line">    .add(&apos;不同主题的 Icon&apos;, iconWithTheme)</span><br><span class="line">    .add(&apos;更多行为的 Icon&apos;, iconWithOther,&#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">            text: `</span><br><span class="line">            ## 引用方法</span><br><span class="line">            ~~~js</span><br><span class="line">            import &#123;Icon&#125; from &apos;lin-react-ui</span><br><span class="line">            ~~~</span><br><span class="line">            更多例子请参见：https://github.com/FortAwesome/react-fontawesome#basic</span><br><span class="line">            `</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run storybook</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>浏览器打开<a href="http://localhost:9009/,可以看到组件库文档生成了。" target="_blank" rel="noopener">http://localhost:9009/,可以看到组件库文档生成了。</a><br><img src="https://upload-images.jianshu.io/upload_images/11846892-f5e3bf4ef4168c78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##5. 发布到npm<br> ✅ ✅ ✅ ✅ ✅</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/reactCom1/" data-id="ckd4b4q2h001rt2p3du6hqxmp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-vueMessage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/vueMessage/" class="article-date">
  <time datetime="2020-07-27T09:15:39.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/vueMessage/">解读element-ui-----this.$message()</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在平时的开发过程中，我们总是先写好一个组件，然后在需要的页面中用 <code>import</code> 引入即可，但如果是下面这种类型的组件呢👇</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-a36600e65a733412?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>上面这种类型的浮层提示有一个很大的特点，就是使用频率特别高，几乎每个页面都会用到它，于是乎我们就要在每个页面中去引入该组件，并且在每个页面都得通过一个变量来控制它的显隐，这显然不是我们想要的🙅。。。那我们想要的是什么样呢🤔？用过一些 UI 框架的同学们应该知道有这样一种用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this.$message(&#123;</span><br><span class="line">    duration: 3000,</span><br><span class="line">    content: &apos;这是一条消息提示&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>没错，就是这么简单的一句话就万事大吉了（就是用 js 调用组件而已啦🧐）。那这种效果究竟是怎么实现的呢？今天就让我们来（手把手🤝 ）一探究竟吧！</p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>不知道小伙伴们有没有用过 <code>Vue.extend()</code> 这个东东，反正我是很少碰过，印象不深，所以这里我们先来短暂了解一下 <code>Vue.extend()</code> 主要是用来干嘛的。先来个官方说明（不多的，坚持下）：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-562ca3309f3120c7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>没怎么看懂？😴没关系，不重要，你只要记住（加少许理解）以下用法即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 导入以往的普通组件</span><br><span class="line">import Main from &apos;./main.vue&apos;;</span><br><span class="line">// 用 Vue.extend 创建组件的模板（构造函数）</span><br><span class="line">let mainConstructor = Vue.extend(Main);</span><br><span class="line">// 实例化组件</span><br><span class="line">let instance = new mainConstructor();</span><br><span class="line">// 挂载到相应的元素上</span><br><span class="line">instance.$mount(&apos;#app&apos;);</span><br></pre></td></tr></table></figure>
<p>不知道你看懂没有，上面的 <code>Vue.extend(Main)</code> 就是一个基于 main.vue 的组件模板（构造函数），<code>instance</code> 是实例化的组件，<code>$mount()</code> 是手动挂载的意思。其中 <code>Vue.extend()</code> 和 <code>$mount()</code> 就是我们通过 js 调用、渲染并挂载组件的精髓所在，相当于早前的 <code>createElement</code> 和 <code>appendChild</code>，有异曲同工之效。这个点需要我们好好熟悉一下，所以你可以先停下来屡屡思路🤔。<br>补充一下🤐：<code>$mount()</code> 里面如果没有参数，说明组件只是渲染了但还没有挂载到页面上，如果有正确的（元素）参数则直接挂载到元素下面。</p>
<h2 id="写一个-message-组件"><a href="#写一个-message-组件" class="headerlink" title="写一个 message 组件"></a>写一个 message 组件</h2><p>js 调用归调用，最原始的组件还是要有的，只是我们不通过 <code>import</code> 来引入到页面中而已。ok，我们就以最开始的那个 message图片来简单写一下这个 vue 组件（element-ui中的message 和 alert 也是一样的）。这里就直接上代码啦，毕竟它的结构简单到爆了，也不是本章节的重点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- message.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;echojoy-message&quot; &gt;</span><br><span class="line">    &lt;p&gt;服务器错误，请稍后重试&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;EchojoyMessage&quot;,</span><br><span class="line">  </span><br><span class="line">  mounted() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        // 3s 后通过父级移除子元素的方式来移除该组件实例和 DOM 节点</span><br><span class="line">        this.$destroy(true);</span><br><span class="line">        this.$el.parentNode.removeChild(this.$el);</span><br><span class="line">      &#125;, 3000);</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.echojoy-message &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  color: #fff;</span><br><span class="line">  z-index: 9999;</span><br><span class="line">  background: transparent;</span><br><span class="line">  &gt; p &#123;</span><br><span class="line">    padding: 12px 22px;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    background: rgba(17, 17, 17, 0.7);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>上面的内容想必大家应该都能看懂，所以这里就直接讲下面的重点了。</p>
<h2 id="写一个-message-js"><a href="#写一个-message-js" class="headerlink" title="写一个 message.js"></a>写一个 message.js</h2><p>我们在 message.vue 的同级目录下新建一个 message.js 文件。我们先瞟一眼文件内容（也不多，已经是个最简版了）👇：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// message.js</span><br><span class="line">import Vue from &quot;vue&quot;; // 引入 Vue 是因为要用到 Vue.extend() 这个方法</span><br><span class="line">import message from &quot;./message.vue&quot;; // 引入刚才的 toast 组件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const Toast = function() &#123;</span><br><span class="line">  instance = new ToastConstructor().$mount(); // 渲染组件</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let messageConstructor = Vue.extend(message); // 这个在前面的前置知识内容里面有讲到</span><br><span class="line">let instance;</span><br><span class="line"></span><br><span class="line">const Message = function (options = &#123;&#125;) &#123;</span><br><span class="line">    instance = new messageConstructor().$mount(); // 渲染组件</span><br><span class="line">    document.body.appendChild(instance.$el); // 挂载到 body 下</span><br><span class="line">&#125;;</span><br><span class="line">export default Message;</span><br></pre></td></tr></table></figure>
<p>上面的代码暴露了一个 Message 函数。为什么要暴露一个函数呢？原因很简单：你想想，我们最终是不是要根据 <code>this.$Message ()</code> 来调用一个组件，说白了，通过 js 调用，本质就是调用一个 函数。也就是说 <code>this.$Message ()</code> 就是执行了上面代码中导出的 <code>export default Message</code>，也就是执行了 Message 函数（<code>const Message = function() {}</code>），所以当我们调用 <code>this.$Message()</code> 的时候其实就是执行了 <code>Message()</code> 函数。而 <code>Message()</code> 函数只做了一件事情：就是通过手动挂载的方式把组件挂载到 body 下面。<br>补充一下🤐：一般来说我们常见的是 <code>$mount(&quot;#app&quot;)</code>，也就是把组件挂载到 <code>#app</code> 下面，<code>&lt;router-view /&gt;</code> 也包含在 <code>#app</code> 中，但是我们这种 Message提示是放在 <code>body</code> 下面的，也就是说它不受 <code>#app</code> 和 <code>&lt;router-view /&gt;</code> 的管控，所以当我们切换页面（路由）的时候，这个 Message 组件是不会跟着立马消失的，这点要注意哦😯。<br>这里顺便给个组件的目录结构，如下图所示：<br><img src="https://upload-images.jianshu.io/upload_images/11846892-2e4a12e3b5f5da91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="message.png"></p>
<h2 id="开始调用"><a href="#开始调用" class="headerlink" title="开始调用"></a>开始调用</h2><p>调用方式很简单，首先我们在入口文件 main.js（和上面不是同一个😢） 里加上两行代码，这样我们就能在需要的地方直接用 js 调用它了，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import EchojoyMessage from &apos;./../packages/message/src/message.js&apos;</span><br><span class="line">Vue.prototype.$message = EchojoyMessage;</span><br></pre></td></tr></table></figure>
<p>然后在页面中测试一下，就像下面这样子：<br><img src="https://upload-images.jianshu.io/upload_images/11846892-09a2f0e7cbe77528.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ALAERT.png"></p>
<p>运行一下代码：<br><img src="https://upload-images.jianshu.io/upload_images/11846892-a3c24b73cd995de6?imageMogr2/auto-orient/strip" alt="image"></p>
<figcaption></figcaption>

<p>嗯，挺好，小有成就的 feel 👏👏👏。</p>
<h2 id="支持可传参数"><a href="#支持可传参数" class="headerlink" title="支持可传参数"></a>支持可传参数</h2><p>别急，我们好像还漏了点什么🤔。。。对了，现在还不支持传参呢，直接调用 <code>this.$message()</code> 就只能显示————服务器错误，请稍后重试（这下全都是后端的锅了😊）。但我们可是个有追求的前端，不能局限于此，所以现在让我们来尝试增加下两个可配置参数，这里拿 <code>duration</code> 和 <code>content</code> 举个栗子🌰。<br>首先我们要修改 message.vue 组件里面的内容（其实没啥大变化），就像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- message.vue 可配置版 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">   &lt;div class=&quot;echojoy-message&quot; &gt;</span><br><span class="line">    &lt;p &gt;</span><br><span class="line">      &#123;&#123;content&#125;&#125; </span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 主要就改了 data</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;EchojoyMessage&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      content: &quot;&quot;,</span><br><span class="line">      duration: 3000</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      this.$destroy(true);</span><br><span class="line">      this.$el.parentNode.removeChild(this.$el);</span><br><span class="line">    &#125;, this.duration);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>上面的代码应该算是浅显易懂了，接下来我们看下 message.js 里面改了啥：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// message.js</span><br><span class="line">import Vue from &quot;vue&quot;; // 引入 Vue 是因为要用到 Vue.extend() 这个方法</span><br><span class="line">import message from &quot;./message.vue&quot;; // 引入刚才的 toast 组件</span><br><span class="line"></span><br><span class="line">let messageConstructor = Vue.extend(message); // 这个在前面的前置知识内容里面有讲到</span><br><span class="line">let instance;</span><br><span class="line"></span><br><span class="line">const Message = function (options = &#123;&#125;) &#123;</span><br><span class="line">  instance = new messageConstructor(&#123;</span><br><span class="line">    data: options // 这里的 data 会传到 message.vue 组件中的 data 中，当然也可以写在 props 里</span><br><span class="line">  &#125;); // 渲染组件</span><br><span class="line">  document.body.appendChild(instance.$mount().$el); // 挂载到 body 下</span><br><span class="line">&#125;;</span><br><span class="line">export default Message;</span><br></pre></td></tr></table></figure>
<p>其实 message.js 也没多大变化，就是在函数里面加了个参数。要注意的是 <code>new messageConstructor({ data: options })</code> 中的 data 就是 message.vue 组件中的 data，不是随随便便取的字段名，传入的 <code>options</code> 会和组件中的 data 合并（Vue 的功劳）。<br>em。。。是的，就这么简单，现在让我们继续来调用一下它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    show()&#123;</span><br><span class="line">      this.$message.success(&#123;</span><br><span class="line">        content: &quot;哈哈哈哈，消失的贼快&quot;,</span><br><span class="line">        duration: 0</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>运行一下就可以看到：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-738632ab3db8fc91?imageMogr2/auto-orient/strip" alt="image"></p>
<figcaption></figcaption>

<p>当然，这还没完，我们继续添加个小功能点🙄。。。</p>
<h2 id="支持-this-message-error"><a href="#支持-this-message-error" class="headerlink" title="支持 this.$message.error()"></a>支持 this.$message.error()</h2><p>这里我们打算支持 <code>this.$message.error()</code> 和 <code>this.$message.success()</code> 这两种方式，所以我们第一步还是要先去修改一下 message.vue 文件的内容（主要就是根据 <code>type</code> 值来修改组件的样式），就像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--main.vue--&gt;</span><br><span class="line">&lt;div class=&quot;echojoy-message&quot; :class=&quot;type ? `echojoy-message--$&#123;type&#125;` : &apos;&apos;&quot;&gt;</span><br><span class="line">    &lt;p class=&quot;echojoy-message-content&quot;&gt;</span><br><span class="line">      &#123;&#123;content&#125;&#125; </span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  ...</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      type: &quot;&quot;,</span><br><span class="line">      content: &quot;&quot;,</span><br><span class="line">      duration: 3000</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.echojoy-message&#123;</span><br><span class="line">  ...</span><br><span class="line">  &amp;--error p &#123; background: rgba(255, 0, 0, 0.5); &#125;</span><br><span class="line">  &amp;--success p &#123; background: rgba(0, 255, 0, 0.5); &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>其次，<code>this.$message.error()</code> 其实就等价于 <code>Message.error()</code>，所以我们现在的目的就是要给 Message函数扩充方法，也比较简单，就先看代码再解释吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// message.js</span><br><span class="line">const Message= function(options = &#123;&#125;) &#123;</span><br><span class="line"> ...</span><br><span class="line">&#125;;</span><br><span class="line">// 以下就是在 Message函数中拓展 [&quot;success&quot;, &quot;error&quot;] 这两个方法</span><br><span class="line"></span><br><span class="line">[&quot;success&quot;, &quot;error&quot;].forEach(type =&gt; &#123;</span><br><span class="line">  Message[type] = options =&gt; &#123;</span><br><span class="line">    options.type = type;</span><br><span class="line">    return Message(options);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default Message;</span><br></pre></td></tr></table></figure>
<p>我们可以看到 <code>Message.error()</code> 和 <code>Message.success()</code> 最终还是调用 <code>Message(options)</code> 这个函数，只不过在调用之前需要多做一步处理，就是将 <code>[&quot;success&quot;, &quot;error&quot;]</code> 作为一个 <code>type</code> 参数给合并进 <code>options</code> 里面再传递，仅此而已😬。<br>那就试试效果吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    show() &#123;</span><br><span class="line">      this.$message(&#123; content: &quot;这是正常的&quot; &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    showError() &#123;</span><br><span class="line">      this.$message.error(&#123; content: &quot;竟然失败了&quot; &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    showSuccess() &#123;</span><br><span class="line">      this.$message.success(&#123; content: &quot;居然成功了&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-6435ed3c174a7160?imageMogr2/auto-orient/strip" alt="image"></p>
<h2 id="duration-lt-0-message一直存在"><a href="#duration-lt-0-message一直存在" class="headerlink" title="duration &lt;= 0,message一直存在"></a>duration &lt;= 0,message一直存在</h2><ul>
<li>传入参数非number类型<br>首先我们为了让组件可以在传入错误类型的duration是能正常使用，做了一个小小的兼容，判断变量类型是否为number，非number类型，控制台输出错误，并强行转化duration为数字1000.（处理办法相当粗暴了！！）</li>
<li>传入参数为number类型移除该组件实例和 DOM 节点<br><code>&gt;0</code><br>在duration的时间范围内，移除该组件实例和 DOM 节点<br><code>&lt;=0</code><br>不做任何处理<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">    if (typeof this.duration !== &apos;number&apos; ) &#123;</span><br><span class="line">      console.error(&apos;the duration must be a number!&apos;)</span><br><span class="line">      this.duration = 1000</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.duration &gt; 0) &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        // 3s 后通过父级移除子元素的方式来移除该组件实例和 DOM 节点</span><br><span class="line">        this.$destroy(true);</span><br><span class="line">        this.$el.parentNode.removeChild(this.$el);</span><br><span class="line">      &#125;, this.duration);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="手动关闭message"><a href="#手动关闭message" class="headerlink" title="手动关闭message"></a>手动关闭message</h2><p>在dom结构上设置可以执行关闭的icon图标,添加事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i class=&quot;echojoy-icon-close echojoy-message-close&quot; @click=&quot;close&quot;&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure></p>
<p>在scripts中增加函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">    close()&#123;</span><br><span class="line">      this.$destroy(true);</span><br><span class="line">      this.$el.parentNode.removeChild(this.$el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h4><p>再见吧！</p>
<p>参考 连接：<a href="https://juejin.im/post/5ca20e426fb9a05e42555d1d" target="_blank" rel="noopener">https://juejin.im/post/5ca20e426fb9a05e42555d1d</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/vueMessage/" data-id="ckd4b4q2r0028t2p3snkjmcr6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Node1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/Node1/" class="article-date">
  <time datetime="2020-07-27T09:13:28.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/Node1/">NO1:使用 Node.js + Express 开发服务端</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、-准备工作"><a href="#一、-准备工作" class="headerlink" title="一、 准备工作"></a>一、 准备工作</h1><hr>
<p>####1.安装Express<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express -g</span><br><span class="line">$ npm install express-generator -g</span><br></pre></td></tr></table></figure></p>
<p>####2.初始化项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /Users/SPRINT/Desktop 进入桌面</span><br><span class="line">$ express 项目名称</span><br></pre></td></tr></table></figure></p>
<p>项目名称我们指定为APIServer，从项目名称可以看出 我们是模拟服务器API<br>在这里我们将提供一个获取用户详情接口 并输出JSON数据。<br><img src="https://upload-images.jianshu.io/upload_images/11846892-f958d66e6ce428e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>在终端最后位置 看到输出两个命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">install dependencies:</span><br><span class="line">   $ cd APIServer &amp;&amp; npm install //告诉我们进入项目根目录 执行npm install安装依赖模块</span><br><span class="line"></span><br><span class="line">run the app:</span><br><span class="line">   $ DEBUG=APIServer:* npm start //告诉我们启动服务器</span><br></pre></td></tr></table></figure>
<p>执行如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd APIServer //进入项目根目录</span><br><span class="line">$ npm install  //安装依赖</span><br></pre></td></tr></table></figure></p>
<p>回到项目中，会看到一个APIServer目录</p>
<blockquote>
<p>bin: 用来启动应用（服务器）<br>public: 存放静态资源目录<br>outes：路由用于确定应用程序如何响应对特定端点的客户机请求，包含一个 URI（或路径）和一个特定的 HTTP 请求方法（GET、POST 等）。每个路由可以具有一个或多个处理程序函数，这些函数在路由匹配时执行。<br>views: 模板文件所在目录 文件格式为.jade<br>目录app.js程序main文件 这个是服务器启动的入口</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-5d35fab3915217e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="二、-启动服务器"><a href="#二、-启动服务器" class="headerlink" title="二、 启动服务器"></a>二、 启动服务器</h1><hr>
<p>首先启动服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/11846892-9bac37c86b235821.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>在浏览器中访问 <a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A3000%2F" target="_blank" rel="noopener">http://localhost:3000/</a></p>
<h2 id="三、-基本使用"><a href="#三、-基本使用" class="headerlink" title="三、 基本使用"></a>三、 基本使用</h2><p>打开<code>app.js</code> 这里介绍下主要代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  var express = require(&apos;express&apos;);</span><br><span class="line">  var path = require(&apos;path&apos;);</span><br><span class="line">  var favicon = require(&apos;serve-favicon&apos;);</span><br><span class="line">  var logger = require(&apos;morgan&apos;);</span><br><span class="line">  var cookieParser = require(&apos;cookie-parser&apos;);</span><br><span class="line">  var bodyParser = require(&apos;body-parser&apos;);</span><br><span class="line"></span><br><span class="line">  var app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">///=======路由信息 （接口地址）开始 存放在./routes目录下===========//</span><br><span class="line">  var routes = require(&apos;./routes/index&apos;);//home page接口</span><br><span class="line">  var users = require(&apos;./routes/users&apos;); //用户接口</span><br><span class="line"></span><br><span class="line">  app.use(&apos;/&apos;, routes); //在app中注册routes该接口 </span><br><span class="line">  app.use(&apos;/users&apos;, users);//在app中注册users接口</span><br><span class="line">///=======路由信息 （接口地址 介绍===========//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">///=======模板 开始===========//</span><br><span class="line">// view engine setup</span><br><span class="line">  app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));</span><br><span class="line">  app.set(&apos;view engine&apos;, &apos;jade&apos;);</span><br><span class="line">///=======模板 结束===========//</span><br></pre></td></tr></table></figure></p>
<p>当我们在浏览器中 访问 <a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A3000%2F" target="_blank" rel="noopener">http://localhost:3000/</a> 调用的就是index中的接口<br>我们打开index.js就可以看到该接口的定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//定义一个get请求 path为根目录</span><br><span class="line">/* GET home page. */</span><br><span class="line">router.get(&apos;/&apos;, function(req, res, next) &#123;</span><br><span class="line">    res.render(&apos;index&apos;, &#123; title: &apos;Express&apos; &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>定义一个路由的基本格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.METHOD(PATH, HANDLER)</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<blockquote>
<p>app 是 express 的实例。<br>METHOD是 <a href="https://links.jianshu.com/go?to=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHypertext_Transfer_Protocol" target="_blank" rel="noopener">HTTP 请求方法</a>。<br>PATH 是服务器上的路径。<br>HANDLER 是在路由匹配时执行的函数。<br>以上的定义代表<br>在根路由 (/) 上（应用程序的主页）对 GET 请求进行响应：</p>
</blockquote>
<p>是不是明白了？</p>
<p>如果我们想要实现一个获取用户信息接口该怎么写呢？<br>新建<code>routes\user.js</code>文件<br>定义一个User模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function User() &#123;</span><br><span class="line">      this.name;</span><br><span class="line">      this.city;</span><br><span class="line">      this.age;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = User;</span><br></pre></td></tr></table></figure>
<p>修改<code>users.js</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var router = express.Router();</span><br><span class="line">var URL = require(&apos;url&apos;);  </span><br><span class="line">var User = require(&apos;./user&apos;);</span><br><span class="line"></span><br><span class="line">/* GET users listing. */</span><br><span class="line">router.get(&apos;/&apos;, function(req, res, next) &#123;</span><br><span class="line">  res.send(&apos;respond with a resource&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&apos;/getUserInfo&apos;, function(req, res, next) &#123;</span><br><span class="line"></span><br><span class="line">  var user = new User();</span><br><span class="line">// 获取url参数 依赖于url模块 使用前需要使用  require(&apos;url&apos;)</span><br><span class="line">  var params = URL.parse(req.url, true).query;</span><br><span class="line"></span><br><span class="line">if(params.id == &apos;1&apos;) &#123;</span><br><span class="line"></span><br><span class="line">  user.name = &quot;ligh&quot;;</span><br><span class="line">  user.age = &quot;1&quot;;</span><br><span class="line">  user.city = &quot;北京市&quot;;</span><br><span class="line"></span><br><span class="line">&#125;else&#123;  </span><br><span class="line">  user.name = &quot;SPTING&quot;;</span><br><span class="line">  user.age = &quot;1&quot;;</span><br><span class="line">  user.city = &quot;杭州市&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var response = &#123;status:1,data:user&#125;;</span><br><span class="line">res.send(JSON.stringify(response));</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>由于users.js路由信息已经在app.js注册<br>停止服务器 重新start服务器即可直接访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure></p>
<p>调用方式<code>http://localhost:3000/users/getUserInfo?id=1</code><br><img src="https://upload-images.jianshu.io/upload_images/11846892-2fef11908aa7525f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>总结：完美！<br>你可能需要：<a href="https://www.jianshu.com/p/02085294b6ed" target="_blank" rel="noopener">NO2:Node JS + MySQL CRUD Workshop : Insert, Update, Select, Delete</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/Node1/" data-id="ckd4b4q14000qt2p38baa9bim" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Node" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/Node/" class="article-date">
  <time datetime="2020-07-27T09:12:00.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/Node/">NO3:Node.js + mysql+Sequelize实现注册接口及校验逻辑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在上一篇的基础上，继续升级!</p>
<p><a href="https://www.jianshu.com/p/02085294b6ed" target="_blank" rel="noopener">NO2:Node JS + MySQL CRUD Workshop : Insert, Update, Select, Delete</a></p>
<h1 id="1、安装依赖"><a href="#1、安装依赖" class="headerlink" title="1、安装依赖"></a>1、安装依赖</h1><ul>
<li><p>安装<code>mysql2</code>+<code>sequelize</code> +  <code>jsonwebtoken</code> + <code>joi</code></p>
</li>
<li><p><code>sequelize</code><br><code>sequelize.js</code> 提供对 <a href="http://www.oschina.net/p/mysql" target="_blank" rel="noopener">MySQL</a>，<a href="http://www.oschina.net/p/mariadb" target="_blank" rel="noopener">MariaDB</a>，<a href="http://www.oschina.net/p/sqlite" target="_blank" rel="noopener">SQLite</a> 和 <a href="http://www.oschina.net/p/postgresql" target="_blank" rel="noopener">PostgreSQL</a> 数据库的简单访问，通过映射数据库条目到对象，或者对象到数据库条目。简而言之，就是 ORM（Object-Relational-Mapper）。Sequelize.js 完全是使用 JavaScript 编写，适用于 Node.js 的环境。<br>参考链接：</p>
</li>
<li><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1101571555324224" target="_blank" rel="noopener">使用Sequelize</a></li>
<li><a href="https://sequelize.org/" target="_blank" rel="noopener">sequelize</a></li>
<li><a href="https://github.com/caiya/node-sequelize/tree/master/bin" target="_blank" rel="noopener">https://github.com/caiya/node-sequelize/tree/master/bin</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save sequelize mysql2 joi jsonwebtoken</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="2、添加-修改配置文件"><a href="#2、添加-修改配置文件" class="headerlink" title="2、添加+修改配置文件"></a>2、添加+修改配置文件</h1><p><code>修改app.js</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line">var indexRouter = require(&apos;./routes/index&apos;);</span><br><span class="line">// var usersRouter = require(&apos;./routes/users&apos;);</span><br><span class="line"></span><br><span class="line">app.use(&apos;/&apos;, indexRouter);</span><br><span class="line">// app.use(&apos;/users&apos;, usersRouter);</span><br></pre></td></tr></table></figure></p>
<p><code>修改bin/www</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const &#123;sequelize&#125; = require(&apos;../models&apos;)</span><br><span class="line">sequelize.sync(&#123;force: false&#125;)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    server.listen(port);</span><br><span class="line">    console.log(`Server started on port $&#123;config.port&#125;`)</span><br><span class="line">  &#125;).catch(function (err) &#123;</span><br><span class="line">    console.log(&apos;failed: &apos; + err);</span><br><span class="line">&#125;);</span><br><span class="line">// server.listen(port);</span><br></pre></td></tr></table></figure></p>
<p><code>新建models/index.js + models/user.js</code>:配置各种数据库模型类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//models/index.js</span><br><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">const Sequelize = require(&apos;sequelize&apos;)</span><br><span class="line">const config = require(&apos;../config/config&apos;)</span><br><span class="line">const db = &#123;&#125;</span><br><span class="line"></span><br><span class="line">const sequelize = new Sequelize(config.database, config.username, config.password, &#123;</span><br><span class="line">  host: config.host,</span><br><span class="line">  dialect: &apos;mysql&apos;,</span><br><span class="line">  pool: &#123;</span><br><span class="line">      max: 5,</span><br><span class="line">      min: 0,</span><br><span class="line">      idle: 30000</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs</span><br><span class="line">  .readdirSync(__dirname)</span><br><span class="line">  .filter((file) =&gt;</span><br><span class="line">    file !== &apos;index.js&apos;</span><br><span class="line">  )</span><br><span class="line">  .forEach((file) =&gt; &#123;</span><br><span class="line">    const model = sequelize.import(path.join(__dirname, file))</span><br><span class="line">    db[model.name] = model</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">Object.keys(db).forEach(function (modelName) &#123;</span><br><span class="line">  if (&apos;associate&apos; in db[modelName]) &#123;</span><br><span class="line">    db[modelName].associate(db)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">db.sequelize = sequelize</span><br><span class="line">db.Sequelize = Sequelize</span><br><span class="line"></span><br><span class="line">module.exports = db</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//models/user.js</span><br><span class="line">const Promise = require(&apos;bluebird&apos;)</span><br><span class="line">const bcrypt = Promise.promisifyAll(require(&apos;bcrypt&apos;))</span><br><span class="line"></span><br><span class="line">// function hashPassword (user, options) &#123;</span><br><span class="line">//   const SALT_FACTOR = 8</span><br><span class="line"></span><br><span class="line">//   if (!user.changed(&apos;password&apos;)) &#123;</span><br><span class="line">//     return</span><br><span class="line">//   &#125;</span><br><span class="line"></span><br><span class="line">//   return bcrypt</span><br><span class="line">//     .genSaltAsync(SALT_FACTOR)</span><br><span class="line">//     .then(salt =&gt; bcrypt.hashAsync(user.password, salt, null))</span><br><span class="line">//     .then(hash =&gt; &#123;</span><br><span class="line">//       user.setDataValue(&apos;password&apos;, hash)</span><br><span class="line">//     &#125;)</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">module.exports = (sequelize, DataTypes) =&gt; &#123;</span><br><span class="line">  const User = sequelize.define(&apos;User&apos;, &#123;</span><br><span class="line">    email: &#123;</span><br><span class="line">      type: DataTypes.STRING,</span><br><span class="line">      unique: true</span><br><span class="line">    &#125;,</span><br><span class="line">    password: DataTypes.STRING</span><br><span class="line">  &#125;, </span><br><span class="line">// &#123;</span><br><span class="line">//     hooks: &#123;</span><br><span class="line">//       beforeCreate: hashPassword,</span><br><span class="line">//       beforeUpdate: hashPassword,</span><br><span class="line">//       beforeSave: hashPassword</span><br><span class="line">//     &#125;</span><br><span class="line">//   &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  User.prototype.comparePassword = function (password) &#123;</span><br><span class="line">    return bcrypt.compareAsync(password, this.password)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  User.associate = function (models) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return User</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>新建config/config.js</code>:数据库相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var config = &#123;</span><br><span class="line">  host     : &apos;localhost&apos;, // 主机名</span><br><span class="line">  username : &apos;root&apos;, // 用户名</span><br><span class="line">  password : &apos;1234567w&apos;, // 口令</span><br><span class="line">  database : &apos;nodemysql&apos;, // 使用哪个数据库</span><br><span class="line">  port: 3000, // 端口号，MySQL默认3306</span><br><span class="line">  authentication: &#123;</span><br><span class="line">    jwtSecret: process.env.JWT_SECRET || &apos;secret&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">module.exports = config;</span><br></pre></td></tr></table></figure>
<p><code>修改router/index.js</code>:添加注册接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// // index.js</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const router = express.Router();</span><br><span class="line">const AuthenticationControllerPolicy = require(&apos;../policies/AuthenticationControllerPolicy&apos;)</span><br><span class="line">const AuthenticationController = require(&apos;../controllers/AuthenticationController&apos;)</span><br><span class="line"></span><br><span class="line">router.post(&apos;/register&apos;,</span><br><span class="line">    AuthenticationControllerPolicy.register,</span><br><span class="line">    AuthenticationController.register)</span><br><span class="line">/* GET home page. */</span><br><span class="line">router.post(&apos;/&apos;, function(req, res, next) &#123;</span><br><span class="line">  res.render(&apos;index&apos;, &#123; title: &apos;Express&apos; &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure></p>
<p><code>新建policies/AuthenticationControllerPolicy.js</code>:用于校验注册逻辑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">const Joi = require(&apos;joi&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  register (req, res, next) &#123;</span><br><span class="line">    const schema = &#123;</span><br><span class="line">      email: Joi.string().email(),</span><br><span class="line">      password: Joi.string().regex(</span><br><span class="line">        new RegExp(&apos;^[a-zA-Z0-9]&#123;8,32&#125;$&apos;)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const &#123;error&#125; = Joi.validate(req.body, schema)</span><br><span class="line">    if (error) &#123;</span><br><span class="line">      switch (error.details[0].context.key) &#123;</span><br><span class="line">        case &apos;email&apos;:</span><br><span class="line">          res.status(400).send(&#123;</span><br><span class="line">            error: &apos;You must provide a valid email address&apos;</span><br><span class="line">          &#125;)</span><br><span class="line">          break</span><br><span class="line">        case &apos;password&apos;:</span><br><span class="line">          res.status(400).send(&#123;</span><br><span class="line">            error: `The password provided failed to match the following rules:</span><br><span class="line">              &lt;br&gt;</span><br><span class="line">              1. It must contain ONLY the following characters: lower case, upper case, numerics.</span><br><span class="line">              &lt;br&gt;</span><br><span class="line">              2. It must be at least 8 characters in length and not greater than 32 characters in length.</span><br><span class="line">            `</span><br><span class="line">          &#125;)</span><br><span class="line">          break</span><br><span class="line">        default:</span><br><span class="line">          res.status(400).send(&#123;</span><br><span class="line">            error: &apos;Invalid registration information&apos;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>新建controllers/AuthenticationController.js</code>:用于在数据库表中创建注册数据逻辑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const &#123;User&#125; = require(&apos;../models&apos;)</span><br><span class="line">const jwt = require(&apos;jsonwebtoken&apos;)</span><br><span class="line">const config = require(&apos;../config/config&apos;)</span><br><span class="line"></span><br><span class="line">function jwtSignUser (user) &#123;</span><br><span class="line">  const ONE_WEEK = 60 * 60 * 24 * 7</span><br><span class="line">  return jwt.sign(user, config.authentication.jwtSecret, &#123;</span><br><span class="line">    expiresIn: ONE_WEEK</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  async register (req, res) &#123;</span><br><span class="line">    console.log(14, req.body)</span><br><span class="line">    try &#123;</span><br><span class="line">      const user = await User.create(req.body)</span><br><span class="line">      console.log(user)</span><br><span class="line">      const userJson = user.toJSON()</span><br><span class="line">      res.send(&#123;</span><br><span class="line">        user: userJson,</span><br><span class="line">        token: jwtSignUser(userJson)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      res.status(400).send(&#123;</span><br><span class="line">        error: &apos;This email account is already in use.&apos;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###3. 接口测试</p>
<blockquote>
<p>此处推荐一款接口测试工具！<code>POSTMAN</code>！ 简单来说，四个词，简单实用大方美观！</p>
</blockquote>
<ul>
<li>打开<code>postman</code><br>用post方法请求接口，可以看到下面可以成功的返回message<br><img src="https://upload-images.jianshu.io/upload_images/11846892-c7be54c38a8b1669.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ul>
<p>按照相关提示进行 注册数据，即可</p>
<p><code>打开数据库可视化工具：</code><br>可以看到在table表中有一个名为user的数据表,在user表中可以看到数据创建成功:<br><img src="https://upload-images.jianshu.io/upload_images/11846892-bb8daab7b371cb5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>我们的注册接口就成功啦！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/Node/" data-id="ckd4b4q10000ot2p3vmpiq26q" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/27/Mysql/" class="article-date">
  <time datetime="2020-07-27T09:11:18.000Z" itemprop="datePublished">2020-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/27/Mysql/">macOS 上安裝 MySQL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>在 macOS 下安裝 MySQL 资料库，并且基本的设定 root 密码。</p>
</blockquote>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><ul>
<li><a href="https://dev.mysql.com/downloads/file/?id=454017" target="_blank" rel="noopener">官网页面</a>下方<code>No thanks, just start my download.</code></li>
<li>借用站点-<a href="https://cdn.ioa.tw/MacEnvInit/mysql-5.6.21-osx10.9-x86_64.dmg" target="_blank" rel="noopener">mysql-5.6.21-osx10.9-x86_64.dmg</a></li>
<li>对<code>mysql-5.6.21-osx10.9-x86_64.dmg</code>点击两下进行安装，点击两下<code>mysql-5.6.21-osx10.8-x86_64.pkg</code> 开始安装</li>
<li>‼️若是 OSX 10.10 以上，请在 安装类型 的步骤时点击自定 把 <code>Startup Item</code> 选择 取消勾选！</li>
<li>安装完成后，打开 系统偏好设置 &gt; MySQL &gt; Start MySQL Server<br>若 系统偏好设置 里面没看到 MySQL 的话，请重开 系统偏好设置<h2 id="变更启动权限"><a href="#变更启动权限" class="headerlink" title="变更启动权限"></a>变更启动权限</h2></li>
<li>每次启动 MySQL 都要输入密码，很麻烦，所以变更一下权限，终端输入命令 <code>sudo chmod 777 /usr/local/mysql/support-files/mysql.server</code><h2 id="加入指令"><a href="#加入指令" class="headerlink" title="加入指令"></a>加入指令</h2></li>
<li>打开终端输入 <code>vim ~/.zshrc</code></li>
<li>在最下面新增 <code>export PATH=&quot;/usr/local/mysql/bin:$PATH&quot;</code>执行<code>:wq</code></li>
<li>退出之后，在终端执行<code>source ~/.zshrc</code><h2 id="设定密码"><a href="#设定密码" class="headerlink" title="设定密码"></a>设定密码</h2></li>
<li>打开终端</li>
<li>进入 MySQL，终端执行命令 <code>mysql -u root</code></li>
<li>执行命令<code>use mysql;</code>选择资料库</li>
<li>执行命令<code>update user set password=PASSWORD(&quot;你的密碼&quot;) where User=&#39;root&#39;;</code> 设定密码</li>
<li>执行命令<code>flush privileges;</code>刷新MySQL</li>
<li>执行命令<code>quit</code> 离开 MySQL</li>
</ul>
<blockquote>
<p>注意！设置密码时，要记得加上引号，假设密码为1234，应该为：<br>update user set password=PASSWORD(“1234”) where User=’root’;</p>
</blockquote>
<p>相关参考：<a href="https://www.ioa.tw/macOS/MySQL.html" target="_blank" rel="noopener">https://www.ioa.tw/macOS/MySQL.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/27/Mysql/" data-id="ckd4b4q11000pt2p36iinj26l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-npmReactBuild" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/08/npmReactBuild/" class="article-date">
  <time datetime="2020-06-08T13:12:16.000Z" itemprop="datePublished">2020-06-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/08/npmReactBuild/">使用react搭建组件库：react+typescript+storybook</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author: Echo<br>Time: 2020-06-08 21:12:16</p>
<h2 id="1-安装组件库"><a href="#1-安装组件库" class="headerlink" title="1. 安装组件库"></a>1. 安装组件库</h2><p>执行安装命令<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx create-react-app echo-rui  --typescript</span><br></pre></td></tr></table></figure></p>
<h2 id="2-组件库配置eslint"><a href="#2-组件库配置eslint" class="headerlink" title="2. 组件库配置eslint"></a>2. 组件库配置eslint</h2><ul>
<li>配置ESlint<br>新建<code>.eslintrc.json</code>文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;extends&quot;: &quot;react-app&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>新建 <code>.vscode/settings.json</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;eslint.validate&quot;: [</span><br><span class="line">    &quot;javascript&quot;,</span><br><span class="line">    &quot;javascriptreact&quot;,</span><br><span class="line">    &#123; &quot;language&quot;: &quot;typescript&quot;, &quot;autoFix&quot;: true &#125;,</span><br><span class="line">    &#123; &quot;language&quot;: &quot;typescriptreact&quot;, &quot;autoFix&quot;: true &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="3-引入依赖"><a href="#3-引入依赖" class="headerlink" title="3. 引入依赖"></a>3. 引入依赖</h2><p>在组件中使用 <code>classname</code>：<a href="https://github.com/jedWatson/classnames" target="_blank" rel="noopener">https://github.com/jedWatson/classnames</a><br>执行安装命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install classnames -D</span><br><span class="line">$ npm install @types/classnames -D</span><br><span class="line">$ npm install node-sass -D</span><br></pre></td></tr></table></figure></p>
<p>使用方法示例：<br>如果对象的key值是变化的，可以采用下面的中括号的形式：[<code>btn-${btnType}</code>]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// btn, btn-lg, btn-primary</span><br><span class="line">const classes = classNames(&apos;btn&apos;, className, &#123;</span><br><span class="line">   [`btn-$&#123;btnType&#125;`]: btnType,</span><br><span class="line">   [`btn-$&#123;size&#125;`]: size,</span><br><span class="line">   &apos;disabled&apos;: (btnType === &apos;link&apos;) &amp;&amp; disabled</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="4-编写组件"><a href="#4-编写组件" class="headerlink" title="4. 编写组件"></a>4. 编写组件</h2><ul>
<li>新建 <code>src/components/Button/button.tsx</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;FC,ButtonHTMLAttributes,AnchorHTMLAttributes&#125; from &quot;react&quot;;</span><br><span class="line">import classnames from &quot;classnames&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 按钮大小</span><br><span class="line">export type ButtonSize = &quot;lg&quot; | &quot;sm&quot;;</span><br><span class="line"></span><br><span class="line">export type ButtonType = &quot;primary&quot; | &quot;default&quot; | &quot;danger&quot; | &quot;link&quot;;</span><br><span class="line"></span><br><span class="line">interface BaseButtonProps &#123;</span><br><span class="line">  /** 自定义类名 */</span><br><span class="line">  className?: string;</span><br><span class="line">  /** 设置Button 的禁用 */</span><br><span class="line">  disabled?: boolean;</span><br><span class="line">  /** 设置Button 的大小 */</span><br><span class="line">  size?: ButtonSize;</span><br><span class="line">  /** 设置Button 的类型 */</span><br><span class="line">  btnType?: ButtonType;</span><br><span class="line">  children: React.ReactNode;</span><br><span class="line">  /** 当btnType为link时，必填 */</span><br><span class="line">  href?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 并集</span><br><span class="line">type NativeButtonProps = BaseButtonProps &amp;</span><br><span class="line">  ButtonHTMLAttributes&lt;HTMLElement&gt;;</span><br><span class="line">type AnchorButtonProps = BaseButtonProps &amp;</span><br><span class="line">  AnchorHTMLAttributes&lt;HTMLElement&gt;;</span><br><span class="line"></span><br><span class="line">// Partial：typescript全局函数，将属性全部变成可选的</span><br><span class="line">export type ButtonProps = Partial&lt;NativeButtonProps &amp; AnchorButtonProps&gt;;</span><br><span class="line"></span><br><span class="line">// 使用react-docgen-typescript-loader的bug，只能使用FC，不能React.FC</span><br><span class="line">export const Button: FC&lt;ButtonProps&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123;</span><br><span class="line">    disabled,</span><br><span class="line">    size,</span><br><span class="line">    btnType,</span><br><span class="line">    children,</span><br><span class="line">    href,</span><br><span class="line">    className,</span><br><span class="line">    ...resetProps</span><br><span class="line">  &#125; = props;</span><br><span class="line"></span><br><span class="line">  const classes = classnames(&quot;echo-btn&quot;, className, &#123;</span><br><span class="line">    [`echo-btn-$&#123;btnType&#125;`]: btnType,</span><br><span class="line">    [`echo-btn-$&#123;size&#125;`]: size,</span><br><span class="line">    &quot;echo-button-disabled&quot;: btnType === &quot;link&quot; &amp;&amp; disabled,</span><br><span class="line">  &#125;);</span><br><span class="line">  if (btnType === &quot;link&quot; &amp;&amp; href) &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;a href=&#123;href&#125; className=&#123;classes&#125; &#123;...resetProps&#125;&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;button className=&#123;classes&#125; disabled=&#123;disabled&#125; &#123;...resetProps&#125;&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Button.defaultProps = &#123;</span><br><span class="line">  disabled: false,</span><br><span class="line">  btnType: &quot;default&quot;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Button;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>新建 <code>src/components/Button/index.tsx</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Button from &quot;./button&quot;;</span><br><span class="line"></span><br><span class="line">export default Button;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>src/components/Button/_style.scss</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../styles/variables/button&quot;;</span><br><span class="line">@import &quot;../../styles/mixin/button&quot;;</span><br><span class="line">.echo-btn &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  font-weight: $btn-font-weight;</span><br><span class="line">  line-height: $btn-line-height;</span><br><span class="line">  color: $body-color;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  text-align: center;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  background-image: none;</span><br><span class="line">  border: $btn-border-width solid transparent;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y,</span><br><span class="line">    $btn-padding-x,</span><br><span class="line">    $btn-font-size,</span><br><span class="line">    $btn-border-radius</span><br><span class="line">  );</span><br><span class="line">  box-shadow: $btn-box-shadow;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  transition: $btn-transition;</span><br><span class="line">  &amp;.echo-button-disabled</span><br><span class="line">  &amp;[disabled] &#123;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">    opacity: $btn-disabled-opacity;</span><br><span class="line">    box-shadow: none;</span><br><span class="line">    &gt; * &#123;</span><br><span class="line">      pointer-events: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-lg &#123;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y-lg,</span><br><span class="line">    $btn-padding-x-lg,</span><br><span class="line">    $btn-font-size-lg,</span><br><span class="line">    $btn-border-radius-lg</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-sm &#123;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y-sm,</span><br><span class="line">    $btn-padding-x-sm,</span><br><span class="line">    $btn-font-size-sm,</span><br><span class="line">    $btn-border-radius-sm</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-primary &#123;</span><br><span class="line">  @include button-style($primary, $primary, $white);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-danger &#123;</span><br><span class="line">  @include button-style($danger, $danger, $white);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-default &#123;</span><br><span class="line">  @include button-style(</span><br><span class="line">    $white,</span><br><span class="line">    $gray-400,</span><br><span class="line">    $body-color,</span><br><span class="line">    $white,</span><br><span class="line">    $primary,</span><br><span class="line">    $primary</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-link &#123;</span><br><span class="line">  font-weight: $font-weight-normal;</span><br><span class="line">  color: $btn-link-color;</span><br><span class="line">  text-decoration: $link-decoration;</span><br><span class="line">  box-shadow: none;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    color: $btn-link-hover-color;</span><br><span class="line">    text-decoration: $link-hover-decoration;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:focus &#123;</span><br><span class="line">    text-decoration: $link-hover-decoration;</span><br><span class="line">    box-shadow: none;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:disabled,</span><br><span class="line">  &amp;.echo-button-disabled &#123;</span><br><span class="line">    color: $btn-link-disabled-color;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>styles/variables/button.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;./common&quot;;</span><br><span class="line">// 按钮基本属性</span><br><span class="line">$btn-font-weight: 400;</span><br><span class="line">$btn-padding-y: 0.375rem !default;</span><br><span class="line">$btn-padding-x: 0.75rem !default;</span><br><span class="line">$btn-font-family: $font-family-base !default;</span><br><span class="line">$btn-font-size: $font-size-base !default;</span><br><span class="line">$btn-line-height: $line-height-base !default;</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 styles/mixin/button.scss`文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@mixin button-size($padding-y, $padding-x, $font-size, $border-raduis) &#123;</span><br><span class="line">  padding: $padding-y $padding-x;</span><br><span class="line">  font-size: $font-size;</span><br><span class="line">  border-radius: $border-raduis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@mixin button-style(</span><br><span class="line">  $background,</span><br><span class="line">  $border,</span><br><span class="line">  $color,</span><br><span class="line">  // lghten,sass内置函数，比$background颜色要浅上7.5%</span><br><span class="line">    $hover-background: lighten($background, 7.5%),</span><br><span class="line">  $hover-border: lighten($border, 10%),</span><br><span class="line">  $hover-color: $color</span><br><span class="line">) </span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>src/styles/index.scss</code>文件中引入组件样式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// index文件主要是引入所有组件的样式。</span><br><span class="line">// 不需要写_，这是sass的一种写法，告诉sass这些样式不打包到css中，只能做导入，也是一种模块化</span><br><span class="line"></span><br><span class="line">// 按钮样式</span><br><span class="line">@import &quot;../components/Button/style&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>src/styles/index.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// index文件主要是引入所有组件的样式。</span><br><span class="line">// 不需要写_，这是sass的一种写法，告诉sass这些样式不打包到css中，只能做导入，也是一种模块化</span><br><span class="line"></span><br><span class="line">// 按钮样式</span><br><span class="line">@import &quot;../components/Button/style&quot;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-删除多余文件-引用组件"><a href="#5-删除多余文件-引用组件" class="headerlink" title="5. 删除多余文件+引用组件"></a>5. 删除多余文件+引用组件</h2><ul>
<li>删除<code>src/App.css</code> + <code>src/logo.svg</code> + <code>src/index.css</code> + <code>src/App.test.js</code> + <code>serviceWorker.ts</code>文件</li>
<li><p>修改<code>App.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &quot;./styles/index.scss&quot;;</span><br><span class="line">import Button, &#123; ButtonType, ButtonSize &#125; from &quot;./components/Button/button&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;Button&gt;hello&lt;/Button&gt;</span><br><span class="line">      &lt;Button disabled&gt;hello&lt;/Button&gt;</span><br><span class="line">      &lt;Button btnType=&quot;primary&quot; size=&quot;sm&quot;&gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">      &lt;Button</span><br><span class="line">        btnType=&quot;danger&quot;</span><br><span class="line">        size=&quot;lg&quot;</span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          alert(111);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">     &lt;Button</span><br><span class="line">        btnType=&quot;link&quot;</span><br><span class="line">        href=&quot;http://www.baidu.com&quot;</span><br><span class="line">        target=&quot;_blank&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">      &lt;Button disabled btnType=&quot;link&quot; href=&quot;http://www.baidu.com&quot;&gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>src/index.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; default as Button &#125; from &quot;./components/Button&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-运行项目"><a href="#6-运行项目" class="headerlink" title="6. 运行项目"></a>6. 运行项目</h2><p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure></p>
<p>访问项目 可以看到button组件成功了！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8690603021ebd620.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##7.单元测试<br>新建<code>src/Button/button.test.tsx</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; render, fireEvent &#125; from &quot;@testing-library/react&quot;;</span><br><span class="line">import Button, &#123; ButtonProps &#125; from &quot;./button&quot;;</span><br><span class="line"></span><br><span class="line">describe(&quot;Button 组件&quot;, () =&gt; &#123;</span><br><span class="line">  it(&apos;默认Button&apos;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      onClick: jest.fn(),</span><br><span class="line">    &#125;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;hello&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&apos;hello&apos;)as HTMLButtonElement;</span><br><span class="line">    // 元素是否被渲染在文档中</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    // 判断标签名</span><br><span class="line">    expect(element.tagName).toEqual(&quot;BUTTON&quot;);</span><br><span class="line">     // 判断是否有类名</span><br><span class="line">     expect(element).toHaveClass(&quot;echo-btn-default&quot;);</span><br><span class="line">     expect(element).not.toHaveClass(&quot;echo-disabled&quot;);</span><br><span class="line">     //   触发点击事件</span><br><span class="line">    fireEvent.click(element);</span><br><span class="line">    expect(testProps.onClick).toHaveBeenCalled();</span><br><span class="line">    expect(element.disabled).toBeFalsy();</span><br><span class="line">  &#125;)</span><br><span class="line">  it(&quot;测试传入不同属性的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      btnType: &quot;primary&quot;,</span><br><span class="line">      size: &quot;lg&quot;,</span><br><span class="line">      className: &quot;test-name&quot;,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;hello&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;hello&quot;) as HTMLButtonElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-primary&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-lg&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;test-name&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;测试当btnType为link和href存在的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      btnType: &quot;link&quot;,</span><br><span class="line">      href: &quot;http://www.baidu.com&quot;,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;Link&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;Link&quot;) as HTMLAnchorElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element.tagName).toEqual(&quot;A&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-link&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;测试禁用的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      onClick: jest.fn(),</span><br><span class="line">      disabled: true,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;Disabled&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;Disabled&quot;) as HTMLButtonElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element.disabled).toBeTruthy();</span><br><span class="line">    fireEvent.click(element);</span><br><span class="line">    expect(testProps.onClick).not.toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm test</span><br></pre></td></tr></table></figure></p>
<p>可以看到单元测试成功通过！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-04f6282ff0e82886.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>##8.组件库实现按需加载</p>
<ul>
<li><p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install node-cmd -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>buildScss.js</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">const cmd = require(&quot;node-cmd&quot;);</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const fs = require(&quot;fs&quot;);</span><br><span class="line">const entryDir = path.resolve(__dirname, &quot;./src/components&quot;);</span><br><span class="line">const outputDir = path.resolve(__dirname, &quot;./dist/components&quot;);</span><br><span class="line">function getScssEntry() &#123;</span><br><span class="line">  let entryMap = &#123;&#125;;</span><br><span class="line">  fs.readdirSync(entryDir).forEach(function (pathName) &#123;</span><br><span class="line">    const entryName = path.resolve(entryDir, pathName);</span><br><span class="line">    const outputName = path.resolve(outputDir, pathName);</span><br><span class="line">    let entryFileName = path.resolve(entryName, &quot;_style.scss&quot;);</span><br><span class="line">    let outputFileName = path.resolve(outputName, &quot;style/index.css&quot;);</span><br><span class="line"></span><br><span class="line">    entryMap[pathName] = &#123;&#125;;</span><br><span class="line">    entryMap[pathName].entry = entryFileName;</span><br><span class="line">    entryMap[pathName].output = outputFileName;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return entryMap;</span><br><span class="line">&#125;</span><br><span class="line">const entry = getScssEntry();</span><br><span class="line">let buildArr = [];</span><br><span class="line">for (const key in entry) &#123;</span><br><span class="line">  const promise = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    cmd.get(`npx node-sass $&#123;entry[key].entry&#125; $&#123;entry[key].output&#125;`, function (</span><br><span class="line">      err,</span><br><span class="line">      data,</span><br><span class="line">      stderr</span><br><span class="line">    ) &#123;</span><br><span class="line">      if (err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      console.log(&quot;the current working dir is : &quot;, data);</span><br><span class="line">      fs.writeFileSync(</span><br><span class="line">        path.join(__dirname, `./dist/components/$&#123;key&#125;/style/css.js`),</span><br><span class="line">        &quot;import &apos;./index.css&apos;&quot;</span><br><span class="line">      );</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  buildArr.push(promise);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.all(buildArr)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;build success&quot;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch((e) =&gt; &#123;</span><br><span class="line">    console.log(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>_babel.config.js</code>文件<br>libraryName:需要加载的库，我这里的是echo-rui<br>libraryDirectory：需要加载的组件库所在的目录，当前的组件是存放在dist/components下的<br>style：加载的css类型，当前项目只有css，没有less，所以这里写css即可，如需配置less,请看注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [&quot;react-app&quot;],</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      &quot;import&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: &quot;echo-rui&quot;, </span><br><span class="line">        camel2DashComponentName: false, // 是否需要驼峰转短线</span><br><span class="line">        camel2UnderlineComponentName: false, // 是否需要驼峰转下划线</span><br><span class="line">        libraryDirectory: &quot;dist/components&quot;,</span><br><span class="line">        style: &quot;css&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    // [&quot;import&quot;, &#123;</span><br><span class="line">    //   &quot;libraryName&quot;: &quot;antd&quot;,</span><br><span class="line">    //   &quot;libraryDirectory&quot;: &quot;es&quot;,</span><br><span class="line">    //   &quot;style&quot;: &quot;css&quot; // `style: true` 会加载 less 文件</span><br><span class="line">    // &#125;]</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>⚠️⚠️⚠️重要说明：在开发的时候，每个组件目录下面必须有一个<code>_style.scss</code>样式文件，即使他是个空文件也必须有，否则会在按需引入的时候报错找不到css文件⚠️⚠️</p>
<p>##9.storybook文档生成</p>
<ol>
<li><p>初始化storyBook</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx -p @storybook/cli sb init</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加依赖和插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @storybook/addon-info --save-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加npm脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">   &quot;storybook&quot;: &quot;start-storybook -p 9009 -s public&quot;,</span><br><span class="line">   &quot;build-storybook&quot;: &quot;build-storybook -s public&quot;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置storybook，支持typescript</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install react-docgen-typescript-loader -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加storybook配置文件</p>
</li>
</ol>
<ul>
<li><p>新建<code>.storybook/webpack.config.js</code>文件<br><code>shouldExtractLiteralValuesFromEnum</code>：storybook爬取组件属性的时候会自动把type类型的属性自动展开。<br><code>propFilter</code>：过滤掉不需要爬取的属性的来源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">module.exports = (&#123; config &#125;) =&gt; &#123;</span><br><span class="line">  config.module.rules.push(&#123;</span><br><span class="line">    test: /\.tsx?$/,</span><br><span class="line">    use: [</span><br><span class="line">      &#123;</span><br><span class="line">        loader: require.resolve(&quot;babel-loader&quot;),</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [require.resolve(&quot;babel-preset-react-app&quot;)]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &#123;</span><br><span class="line">        loader: require.resolve(&quot;react-docgen-typescript-loader&quot;),</span><br><span class="line">        options: &#123;</span><br><span class="line">          shouldExtractLiteralValuesFromEnum: true,</span><br><span class="line">          propFilter: (prop) =&gt; &#123;</span><br><span class="line">            if (prop.parent) &#123;</span><br><span class="line">              return !prop.parent.fileName.includes(&apos;node_modules&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">            return true            </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  config.resolve.extensions.push(&quot;.ts&quot;, &quot;.tsx&quot;);</span><br><span class="line"></span><br><span class="line">  return config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>.storybook/style.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// 这个文件主要是对storybook文档样式的配置</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>.storybook/config.tsx</code>文件<br>配置插件以及需要加载的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; configure,addDecorator,addParameters &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123; withInfo &#125; from &apos;@storybook/addon-info&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &apos;../src/styles/index.scss&apos;</span><br><span class="line">import &apos;./style.scss&apos;</span><br><span class="line">import React from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">const wrapperStyle: React.CSSProperties = &#123;</span><br><span class="line">  padding: &apos;20px 40px&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const storyWrapper = (stroyFn: any) =&gt; (</span><br><span class="line">  &lt;div style=&#123;wrapperStyle&#125;&gt;</span><br><span class="line">    &lt;h3&gt;组件演示&lt;/h3&gt;</span><br><span class="line">    &#123;stroyFn()&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line">addDecorator(storyWrapper)</span><br><span class="line">addDecorator(withInfo)</span><br><span class="line">addParameters(&#123;info: &#123; inline: true, header: false&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const loaderFn = () =&gt; &#123;</span><br><span class="line">    const allExports = [];</span><br><span class="line">    const req = require.context(&apos;../src/components&apos;, true, /\.stories\.tsx$/);</span><br><span class="line">    req.keys().forEach(fname =&gt; allExports.push(req(fname)));</span><br><span class="line">    return allExports;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">configure(loaderFn, module);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="6">
<li>在每个组件目录下面新建一个<code>.stories.tsx</code>结尾的文件</li>
</ol>
<ul>
<li>button组件下新建<code>button.stories.tsx</code>文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; storiesOf &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123; action &#125; from &apos;@storybook/addon-actions&apos;;</span><br><span class="line"></span><br><span class="line">import Button from &apos;./button&apos;</span><br><span class="line"></span><br><span class="line">const defaultButton = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;default button&apos;)&#125;&gt;default button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const buttonWithSize = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button size=&apos;lg&apos; btnType=&apos;primary&apos; onClick=&#123;action(&apos;lg button&apos;)&#125;&gt;lg button&lt;/Button&gt;</span><br><span class="line">        &lt;Button className=&apos;ml-20&apos; size=&apos;sm&apos; btnType=&apos;danger&apos; onClick=&#123;action(&apos;sm button&apos;)&#125;&gt;sm button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const buttonWithType = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;danger button&apos;)&#125; btnType=&apos;danger&apos;&gt;danger button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;primary button&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;primary&apos;&gt;primary button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;link&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;link&apos; href=&apos;https://www.baidu.com/&apos;&gt;link&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const buttonWithDisabled = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;disabled button&apos;)&#125; btnType=&apos;danger&apos; disabled=&#123;true&#125;&gt;disabled button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;unDisabled button&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;primary&apos;&gt;unDisabled button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// storiesOf(&apos;Button组件&apos;, module)</span><br><span class="line">// .addDecorator(withInfo)</span><br><span class="line">// .addParameters(&#123;</span><br><span class="line">//     info:&#123;</span><br><span class="line">//         text:`</span><br><span class="line">//         这是默认组件</span><br><span class="line">//         ~~~js</span><br><span class="line">//         const a = 12</span><br><span class="line">//         ~~~</span><br><span class="line">//         `,</span><br><span class="line">//         inline:true</span><br><span class="line">//     &#125;</span><br><span class="line">// &#125;)</span><br><span class="line">//   .add(&apos;默认 Button&apos;, defaultButton)</span><br><span class="line">//   .add(&apos;不同尺寸 Button&apos;, buttonWithSize,&#123;info:&#123;inline:false&#125;&#125;)</span><br><span class="line">//   .add(&apos;不同类型 Button&apos;, buttonWithType)</span><br><span class="line"></span><br><span class="line">storiesOf(&apos;Button 按钮&apos;, module)</span><br><span class="line">    .addParameters(&#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">            text: `</span><br><span class="line">        ## 引用方法</span><br><span class="line">        ~~~js</span><br><span class="line">        import &#123;Button&#125; from ecoh-rui</span><br><span class="line">        ~~~</span><br><span class="line">        `</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .add(&apos;默认 Button&apos;, defaultButton)</span><br><span class="line">    .add(&apos;不同尺寸 Button&apos;, buttonWithSize)</span><br><span class="line">    .add(&apos;不同类型 Button&apos;, buttonWithType)</span><br><span class="line">    .add(&apos;禁用的 Button&apos;,buttonWithDisabled)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>7.执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run storybook</span><br></pre></td></tr></table></figure></p>
<p>在终端可以看到<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8b43e51f15d70e6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>浏览器打开<code>http://localhost:9009/</code>,可以看到组件库文档生成了。<br><img src="https://upload-images.jianshu.io/upload_images/11846892-151907d5b1ed9637.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="10-typescript编译配置"><a href="#10-typescript编译配置" class="headerlink" title="10. typescript编译配置"></a>10. typescript编译配置</h2><p>新建<code>tsconfig.build.json</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    // 输出路径</span><br><span class="line">    &quot;outDir&quot;: &quot;dist&quot;,</span><br><span class="line">    // 打包模块规范</span><br><span class="line">    &quot;module&quot;: &quot;esnext&quot;,</span><br><span class="line">    // 构建目标</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">    // 生成定义文件d.ts</span><br><span class="line">    &quot;declaration&quot;: true,</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;,</span><br><span class="line">    // 模块引入策略</span><br><span class="line">    &quot;moduleResolution&quot;: &quot;Node&quot;,</span><br><span class="line">    // 允许import React from &apos;react&apos;这样导包</span><br><span class="line">    &quot;allowSyntheticDefaultImports&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  // 需要编译的目录</span><br><span class="line">  &quot;include&quot;: [&quot;src&quot;],</span><br><span class="line">  // 不需要编译的</span><br><span class="line">  &quot;exclude&quot;: [&quot;src/**/*.test.tsx&quot;, &quot;src/**/*.stories.tsx&quot;, &quot;src/setupTests.ts&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="11-package-json相关配置"><a href="#11-package-json相关配置" class="headerlink" title="11. package.json相关配置"></a>11. package.json相关配置</h2><ul>
<li><p>将依赖包从dependencies搬到devDependencie</p>
<blockquote>
<p>为什么要这么做？<br>一、是防止发布组件库之后别人使用了跟我们不一样的react版本造成冲突<br>二、是我们在开发的时候还需要使用到react和react-dom，所以不能删除，只能搬到devDependencies<br>三、还有一些跟发布后的组件库不相关的依赖都需要搬到devDependencies，例如storybook等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 嘿嘿，移动之后，发现为空了，重新install 了一下</span><br><span class="line">// 运行了npm start 和npm run test 和npm run storybook发现一切正常，开心一下！！</span><br><span class="line">&quot;dependencies&quot;: &#123;&#125;,</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>添加npm发布相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&quot;description&quot;: &quot;react components library&quot;,</span><br><span class="line">&quot;author&quot;: &quot;echo&quot;,</span><br><span class="line">&quot;private&quot;: false,</span><br><span class="line">// 主入口</span><br><span class="line">&quot;main&quot;: &quot;dist/index.js&quot;,</span><br><span class="line">// 模块入口</span><br><span class="line">&quot;module&quot;: &quot;dist/index.js&quot;,</span><br><span class="line">// 类型文件声明</span><br><span class="line">&quot;types&quot;: &quot;dist/index.d.ts&quot;,</span><br><span class="line">&quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">// 关键词</span><br><span class="line">&quot;keywords&quot;: [</span><br><span class="line">    &quot;React&quot;,</span><br><span class="line">    &quot;UI&quot;,</span><br><span class="line">    &quot;Component&quot;,</span><br><span class="line">    &quot;typescript&quot;</span><br><span class="line">  ],</span><br><span class="line">// 首页你的github地址</span><br><span class="line">  &quot;homepage&quot;: &quot;https://github.com/.../echo-rui&quot;,</span><br><span class="line">// 仓库地址</span><br><span class="line">  &quot;repository&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;git&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;https://github.com/.../echo-ruii&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 需要上传的文件，不写就默认以.gitignore为准</span><br><span class="line">  &quot;files&quot;: [</span><br><span class="line">    &quot;dist&quot;</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码提交git前检查。这里使用husky这个工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;husky&quot;: &#123;</span><br><span class="line">    &quot;hooks&quot;: &#123;</span><br><span class="line">    // 用git提交代码之前</span><br><span class="line">      &quot;pre-commit&quot;: &quot;npm run test:nowatch &amp;&amp; npm run lint&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">    &quot;lint&quot;: &quot;eslint --ext js,ts,tsx src --fix --max-warnings 5&quot;,</span><br><span class="line">    &quot;test:nowatch&quot;: &quot;cross-env CI=true react-scripts test&quot;,</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加打包发布相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">    &quot;clean&quot;: &quot;rimraf ./dist&quot;,</span><br><span class="line">    &quot;build-ts&quot;: &quot;tsc -p tsconfig.build.json&quot;,</span><br><span class="line">    &quot;build-css&quot;: &quot;node-sass ./src/styles/index.scss ./dist/index.css&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;npm run clean &amp;&amp; npm run build-ts &amp;&amp; npm run build-css &amp;&amp; node ./buildScss.js&quot;,</span><br><span class="line">    &quot;prepublishOnly&quot;: &quot;npm run lint &amp;&amp; npm run build&quot;</span><br><span class="line">  </span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>此时执行打包命令，就可以成功根据配置打包了。</p>
<h2 id="12-发布到npm"><a href="#12-发布到npm" class="headerlink" title="12. 发布到npm"></a>12. 发布到npm</h2><p>万事俱备，只欠发布。</p>
<ul>
<li>完善一下 README.md 文档，这个随便写两句就好</li>
<li>在根目录下新建一个 .npmignore 文件，内容和 .gitignore 差不多：<pre><code>
</code></pre>最后执行 npm login 登入 npm 账号，再执行 npm publish 发布即可，就这么简单的两步就可以，过一会在 npm 上就能搜到了。当然前提是你有个 npm 账号，没有的话去注册一个吧，很 easy 的，然后还要搜下你的 npm 包名是否有人用，有的话就换一个。</li>
</ul>
<h1 id="总结：完美！"><a href="#总结：完美！" class="headerlink" title="总结：完美！"></a>总结：完美！</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/08/npmReactBuild/" data-id="ckd4b4q27001mt2p31iynb75s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npm-react-typescript/">npm react typescript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog-hexo/">blog-hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-vue/">es6, vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm-react-typescript/">npm react typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-test/">vue test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-vueRouter/">vue, vueRouter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端面试题/">前端面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/blog-hexo/" style="font-size: 13.33px;">blog-hexo</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/es6-vue/" style="font-size: 10px;">es6, vue</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/js/" style="font-size: 13.33px;">js</a> <a href="/tags/node/" style="font-size: 13.33px;">node</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/npm-react-typescript/" style="font-size: 10px;">npm react typescript</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a> <a href="/tags/vue-test/" style="font-size: 10px;">vue test</a> <a href="/tags/vue-vueRouter/" style="font-size: 10px;">vue, vueRouter</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/前端面试题/" style="font-size: 16.67px;">前端面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/27/vueI18/">vue项目中引入&amp;使用国际化</a>
          </li>
        
          <li>
            <a href="/2020/07/27/fixProject/">如何优化项目</a>
          </li>
        
          <li>
            <a href="/2020/07/27/axios1/">Axios源码解析</a>
          </li>
        
          <li>
            <a href="/2020/07/27/reactCom2/">使用react搭建组件库--radio组件</a>
          </li>
        
          <li>
            <a href="/2020/07/27/reactCom1/">使用react搭建组件库--icon组件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>