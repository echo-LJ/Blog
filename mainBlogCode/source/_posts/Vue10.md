---
title: Vue3.0çš„ä¼˜åŒ–
date: 2020-11-22 10:00:00
tags: Vue
---

<meta name="referrer" content="no-referrer"/>

#### Vue1.x ----> Vue2.x
å¼•å…¥äº†`è™šæ‹ŸDom`çš„æ¦‚å¿µï¼š ä¸ºåç»­åš`æœåŠ¡ç«¯æ¸²æŸ“`ä»¥åŠ`è·¨ç«¯æ¡†æ¶Weex`æä¾›äº†åŸºç¡€ã€‚

#### Vue2.xçš„ç—›ç‚¹ + å…¶ä»–ä¼˜åŒ–è€ƒè™‘
**ç—›ç‚¹**
* æºç è‡ªèº«çš„ç»´æŠ¤æ€§
* æ•°æ®é‡å¤§åå¸¦æ¥çš„æ¸²æŸ“å’Œæ›´æ–°çš„æ€§èƒ½é—®é¢˜
* ä¸€äº›æƒ³èˆå¼ƒä½†ä¸ºäº†å…¼å®¹ä¸€ç›´ä¿ç•™çš„é¸¡è‚‹API
**å…¶ä»–ä¼˜åŒ–è€ƒè™‘**
* æ›´å¥½çš„Typescriptæ”¯æŒ
* æ›´å¥½çš„é€»è¾‘å¤ç”¨å®è·µï¼ˆmixinså¸¦æ¥çš„é€»è¾‘æ¨¡ç³Šï¼‰

# Vue3.0çš„ä¼˜åŒ–

## ä¸€ã€æºç çš„ä¼˜åŒ–
----
### 1ã€æ›´å¥½çš„ä»£ç ç®¡ç†æ–¹å¼ï¼š monorepo
monorepoï¼š ä¸€ä¸ªé¡¹ç›®ä»“åº“ï¼ˆrepoï¼‰ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—/åŒ…ï¼ˆpackageï¼‰
æ‰©å±•ï¼š ç›®å‰æœ‰å¾ˆå¤šå¤§å‹å¼€æºé¡¹ç›®é‡‡ç”¨äº†è¿™ç§æ–¹å¼ï¼š Babelã€ create-react-appã€ react-routerç­‰ã€‚

Vue2.xæ ¹æ®åŠŸèƒ½æ‹†åˆ†å‡ºäº†å‡ ä¸ªç›®å½•ï¼š
![image.png](https://s0.lgstatic.com/i/image/M00/2C/DC/Ciqc1F8Cn6mAHaUrAACzRBFsL1g844.png)

* compilerï¼ˆæ¨¡æ¿ç¼–è¯‘çš„ç›¸å…³ä»£ç ï¼‰
* coreï¼ˆä¸å¹³å°æ— å…³çš„é€šç”¨è¿è¡Œæ—¶ä»£ç ï¼‰
* platformsï¼ˆå¹³å°ä¸“æœ‰ä»£ç ï¼‰
* serverï¼ˆæœåŠ¡ç«¯æ¸²æŸ“çš„ç›¸å…³ä»£ç ï¼‰
* sfcï¼ˆ.vue å•æ–‡ä»¶è§£æç›¸å…³ä»£ç ï¼‰
* sharedï¼ˆå…±äº«å·¥å…·ä»£ç ï¼‰ ç­‰ç›®å½•

Vue3.0æ ¹æ®åŠŸèƒ½å°†ä¸åŒçš„æ¨¡å—æ‹†åˆ†åˆ°packagesç›®å½•ä¸‹é¢çš„ä¸åŒå­ç›®å½•ä¸­ï¼š
![image.png](https://s0.lgstatic.com/i/image/M00/2C/DC/Ciqc1F8Cn7KAELkqAAJkxFes1zw593.png)

æ¯ä¸ªpackageæœ‰å„è‡ªçš„APIã€ç±»å‹å®šä¹‰ã€æµ‹è¯•ã€‚
ä¼˜ç‚¹ï¼š ä½¿æ¨¡å—æ‹†åˆ†æ›´ç»†åŒ–ã€èŒè´£åˆ’åˆ†æ›´æ˜ç¡®ï¼Œæ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»æ›´æ˜ç¡®ã€‚

å¦å¤–ä¸€äº›packageï¼ˆreactivityå“åº”å¼åº“ï¼‰æ˜¯å¯ä»¥ç‹¬ç«‹äºVue.jsä½¿ç”¨çš„ï¼Œå¦‚æœåªæƒ³ä½¿ç”¨Vue.js3.0çš„å“åº”å¼èƒ½åŠ›ï¼Œå¯ä»¥å•ç‹¬ä¾èµ–è¿™ä¸ªå“åº”å¼åº“è€Œä¸å»ä¾èµ–æ•´ä¸ªVue.js,ä»è€Œ`å‡å°äº†å¼•ç”¨åŒ…çš„ä½“ç§¯å¤§å°`ã€‚

### 2.æœ‰ç±»å‹çš„Javascript: Typescript

ç±»å‹è¯­è¨€ä¼˜ç‚¹ï¼š æœ‰åˆ©äºä»£ç çš„ç»´æŠ¤ã€é¿å…äº†ç±»å‹å¯¼è‡´çš„é”™è¯¯ã€æœ‰åˆ©äºæ¥å£çš„å®šä¹‰ã€åˆ©äºIDEå¯¹å˜é‡ç±»å‹çš„æ¨å¯¼ã€‚
* Vue1.xæ²¡æœ‰è¯­æ³•æ£€æŸ¥
* Vue2.xé€‰æ‹©Flow
Flow æ˜¯ Facebook å‡ºå“çš„ JavaScript é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ã€‚å®ƒå¯ä»¥ä»¥éå¸¸å°çš„æˆæœ¬å¯¹å·²æœ‰çš„ JavaScript ä»£ç è¿å…¥ï¼Œéå¸¸çµæ´»ã€‚
ä½†æ˜¯Flowå¯¹äºå¤æ‚åœºæ™¯ç±»å‹çš„æ£€æŸ¥ï¼Œæ”¯æŒçš„ä¸å¥½ï¼Œåœ¨Vue2.xä¸­ï¼Œæœ‰å¯¹Flowçš„åæ§½ã€‚
```
const propOptions: any = vm.$options.props // wtf flow?
```
ç”±äºè¿™é‡Œ Flow å¹¶æ²¡æœ‰æ­£ç¡®æ¨å¯¼å‡º vm.$options.props çš„ç±»å‹ ï¼Œå¼€å‘äººå‘˜ä¸å¾—ä¸å¼ºåˆ¶ç”³æ˜ propsOptions çš„ç±»å‹ä¸º anyï¼Œæ˜¾å¾—å¾ˆä¸åˆç†.

* Vue3.0ä½¿ç”¨Typescript é‡æ„äº†æ•´ä¸ªé¡¹ç›®

## äºŒã€æ€§èƒ½çš„ä¼˜åŒ–
----
### 1ã€æºç ä½“ç§¯çš„ä¼˜åŒ–
JavaScript åŒ…ä½“ç§¯è¶Šå°ï¼Œæ„å‘³ç€ç½‘ç»œä¼ è¾“æ—¶é—´è¶ŠçŸ­ï¼ŒJavaScript å¼•æ“è§£æåŒ…çš„é€Ÿåº¦ä¹Ÿè¶Šå¿«ã€‚

> Vue.js 3.0 åœ¨æºç ä½“ç§¯çš„å‡å°‘æ–¹é¢åšäº†å“ªäº›å·¥ä½œå‘¢ï¼Ÿ

* é¦–å…ˆï¼Œç§»é™¤ä¸€äº›å†·é—¨çš„ `feature`ï¼ˆæ¯”å¦‚ filterã€inline-template ç­‰ï¼‰ï¼›
* å…¶æ¬¡ï¼Œå¼•å…¥ `tree-shaking` çš„æŠ€æœ¯ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯ã€‚

**`tree-shaking`**: åˆ©ç”¨ES2015æ¨¡å—è¯­æ³•çš„é™æ€ç»“æ„ï¼ˆå³ import å’Œ exportï¼‰ï¼Œé€šè¿‡`ç¼–è¯‘é˜¶æ®µ`çš„é™æ€åˆ†æï¼Œæ‰¾åˆ°æ²¡æœ‰å¼•å…¥çš„æ¨¡å—å¹¶æ‰“ä¸Šæ ‡è®°ã€‚
ç„¶å`å‹ç¼©é˜¶æ®µ`ä¼šåˆ©ç”¨ä¾‹å¦‚uglify-jsã€terser ç­‰å‹ç¼©å·¥å…·çœŸæ­£åœ°åˆ é™¤è¿™äº›æ²¡æœ‰ç”¨åˆ°çš„ä»£ç ã€‚ä¾‹å¦‚é¡¹ç›®ä¸­æ²¡æœ‰ç”¨åˆ°Transitionã€keepAliveç­‰ç»„ä»¶ï¼Œå¯¹åº”çš„ä»£ç å°±ä¸ä¼šæäº¤ï¼Œè¿™æ ·å°±é—´æ¥è¾¾åˆ°äº†å‡å°‘Vue.jsåŒ…ä½“ç§¯çš„ç›®çš„ã€‚
### 2ã€æ•°æ®åŠ«æŒä¼˜åŒ–
æ•°æ®åŠ«æŒï¼šå½“æ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œä¸ºäº†è‡ªåŠ¨æ›´æ–°DOM,å¿…é¡»åŠ«æŒæ•°æ®çš„æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯å½“æ•°æ®å‘ç”Ÿæ”¹å˜åèƒ½è‡ªåŠ¨æ‰§è¡Œä¸€äº›ä»£ç å»æ›´æ–°DOMï¼Œé‚£ä¹ˆVue.jså¦‚ä½•çŸ¥é“æ›´æ–°å“ªä¸€ç‰‡DOMå‘¢ï¼Ÿï¼ˆå¤§ä½“çš„æ€è·¯ï¼‰å› ä¸ºåœ¨æ¸²æŸ“DOMçš„æ—¶å€™è®¿é—®äº†æ•°æ®ï¼Œæˆ‘ä»¬å¯¹å®ƒè¿›è¡Œè®¿é—®åŠ«æŒï¼Œåœ¨å†…éƒ¨è¿›è¡Œä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±çŸ¥é“æ•°æ®å¯¹åº”çš„DOMæ˜¯ä»€ä¹ˆäº†ã€‚

* Vue.js1.xå’ŒVue.js2.xæ˜¯é€šè¿‡`Object.defineProperty`è¿™ä¸ªApiå»åŠ«æŒæ•°æ®çš„getterå’Œsetter
**`**ç¼ºé™·ï¼š`**
1.å¿…é¡»çŸ¥é“æ‹¦æˆªçš„Keyæ˜¯ä»€ä¹ˆï¼Œä»–ä¸èƒ½æ£€æµ‹å¯¹è±¡å±æ€§çš„æ·»åŠ å’Œåˆ é™¤
**Vueè§£å†³åŠæ³•:** æä¾›äº†`$set`å’Œ`$delete`æ–¹æ³•ã€‚
2. å¯¹äºåµŒå¥—å±‚çº§æ¯”è¾ƒæ·±çš„å¯¹è±¡
**Vueè§£å†³åŠæ³•:** å¦‚æœè¦åŠ«æŒå®ƒå†…éƒ¨æ·±å±‚æ¬¡çš„å¯¹è±¡ï¼Œéå†é€’å½’æ•´ä¸ªå¯¹è±¡ï¼Œæ‰§è¡ŒObject.definePropertyæŠŠæ¯ä¸€å±‚å¯¹è±¡æ•°æ®éƒ½å˜æˆå“åº”å¼çš„ã€‚

* Vue.js3.0sä½¿ç”¨äº†`Proxy API`åšæ•°æ®åŠ«æŒ
1. ä»–åŠ«æŒçš„æ˜¯æ•´ä¸ªå¯¹è±¡ï¼Œå¯¹äºå¯¹è±¡å±æ€§çš„å¢åŠ å’Œåˆ é™¤éƒ½èƒ½æ£€æµ‹åˆ°ã€‚
2. å¯¹äºåµŒå¥—å±‚çº§æ¯”è¾ƒæ·±çš„å¯¹è±¡
**Vueè§£å†³åŠæ³•:** åœ¨Getterä¸­å»é€’å½’å“åº”å¼ï¼Œå¥½å¤„æ˜¯çœŸæ­£è®¿é—®åˆ°çš„å†…éƒ¨å¯¹è±¡æ‰ä¼šå˜æˆå“åº”å¼ï¼Œè€Œä¸æ˜¯æ— è„‘é€’å½’ï¼Œå¢åŠ äº†æ€§èƒ½ã€‚

### 3ã€ç¼–è¯‘ä¼˜åŒ–
![image.png](https://s0.lgstatic.com/i/image/M00/2C/FF/CgqCHl8Cuf2AZw70AAEFU2EMA50521.png)

* Vue.js2.xä¸­ä» new Vue å¼€å§‹æ¸²æŸ“DOMçš„æµç¨‹ï¼Œåœ¨inité˜¶æ®µå¤„ç†å“åº”å¼ï¼ˆæ•°æ®åŠ«æŒä¼˜åŒ–ï¼‰ï¼Œè¿˜æœ‰è€—æ—¶è¾ƒå¤šçš„patché˜¶æ®µã€‚
`diffè¿‡ç¨‹ç¼ºç‚¹:`
**ä¸¾ä¸ªğŸŒ°ï¼š**ä¸€æ®µä»£ç ä¸­æœ‰å¤šä¸ªåŒçº§domèŠ‚ç‚¹ï¼Œä½†åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ç»‘å®šäº†åŠ¨æ€æ•°æ®ã€‚
å¯¼è‡´é—®é¢˜ï¼švnodeçš„æ€§èƒ½è·Ÿæ¨¡ç‰ˆå¤§å°æ­£ç›¸å…³ï¼Œè·ŸåŠ¨æ€èŠ‚ç‚¹çš„æ•°é‡æ— å…³ï¼Œå½“ä¸€äº›ç»„ä»¶å†…åªæœ‰å°‘é‡åŠ¨æ€èŠ‚ç‚¹ï¼Œå¾ˆå¤šçš„diffå’Œéå†éƒ½æ˜¯æµªè´¹æ€§èƒ½ï¼Œ

* Vue3.0 é€šè¿‡ç¼–è¯‘é˜¶æ®µå¯¹é™æ€æ¨¡ç‰ˆçš„åˆ†æï¼Œç¼–è¯‘ç”Ÿæˆäº†`Block tree`

Block treeæ˜¯ä¸€ä¸ªå°†æ¨¡ç‰ˆåŸºäºåŠ¨æ€èŠ‚ç‚¹æŒ‡ä»¤åˆ‡å‰²çš„åµŒå¥—åŒºå—ï¼Œæ¯ä¸ªåŒºå—å†…éƒ¨çš„èŠ‚ç‚¹ç»“æ„éƒ½æ˜¯å›ºå®šçš„ï¼Œå€ŸåŠ©Block treeå°†vnodeæ›´æ–°æ€§èƒ½ç”±ä¸æ¨¡ç‰ˆæ•´ä½“å¤§å°æå‡ä¸ºä¸åŠ¨æ€å†…å®¹çš„æ•°é‡ç›¸å…³ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œ3ï¼Œ0è¿˜åŒ…å«äº†å¯¹Slotçš„ç¼–è¯‘ä¼˜åŒ–ï¼Œäº‹ä»¶ä¾¦å¬å‡½æ•°çš„ç¼“å­˜ä¼˜åŒ–ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶é‡å†™äº†diffç®—æ³•ã€‚
## ä¸‰ã€è¯­æ³•APIä¼˜åŒ–ï¼š composition API
----
### 1ã€ä¼˜åŒ–é€»è¾‘ç»„ç»‡

* Vue.js1.xå’ŒVue.js2.xä½¿ç”¨`Options API`
ç¼–è¯‘ç»„ä»¶çš„æ—¶å€™ï¼Œä¸€ä¸ªç»„ä»¶å¯èƒ½æœ‰å¤šä¸ªé€»è¾‘ç‚¹ï¼Œå½“ä½¿ç”¨ptions APIçš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹éƒ½æœ‰è‡ªå·±çš„Options,å¦‚æœéœ€è¦ä¿®æ”¹ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹ï¼Œå°±éœ€è¦åœ¨å•ä¸ªæ–‡ä»¶ä¸­ä¸æ–­ä¸Šä¸‹åˆ‡æ¢å’Œå¯»æ‰¾ã€‚
* Vue.js3.0ä½¿ç”¨`Composition API`
æŸä¸ªé€»è¾‘å…³æ³¨ç‚¹ç›¸å…³çš„ä»£ç éƒ½æ”¾åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œå°±ä¸éœ€è¦åœ¨æ–‡ä»¶ä¸­è·³æ¥è·³å»ã€‚

### 1ã€ä¼˜åŒ–é€»è¾‘å¤ç”¨ mixins

**é—®é¢˜ï¼š**å½“ä¸€ä¸ªé¡¹ç›®ä¸­æ··å…¥å¤§é‡mixinsï¼Œä¼šæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼Œå‘½åå†²çªå’Œæ•°æ®æ¥æºä¸æ¸…æ™°ã€‚

mixinå¯ä»¥å®šä¹‰è‡ªå·±çš„props,data,å¹¶ä¸”ä»–ä»¬ä¹‹é—´æ˜¯æ— æ„Ÿçš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å®šä¹‰ç›¸åŒçš„å˜é‡ï¼Œå¯¼è‡´å‘½åå†²çªï¼Œå¯¼è‡´æ•°æ®æ¥æºä¸æ¸…æ™°ã€‚

* Vue3.0ä¹¦å†™ç¤ºä¾‹ï¼š
```
//mousePositionMixin.js
import { ref, onMounted, onUnmounted } from 'vue'
export default function useMousePosition() {
  const x = ref(0)
  const y = ref(0)
  const update = e => {
    x.value = e.pageX
    y.value = e.pageY
  }
  onMounted(() => {
    window.addEventListener('mousemove', update)
  })
  onUnmounted(() => {
    window.removeEventListener('mousemove', update)
  })
  return { x, y }
}
```
ä½¿ç”¨ç¤ºä¾‹ï¼š
```
<template>
  <div>
    Mouse position: x {{ x }} / y {{ y }}
  </div>
</template>
<script>
  import useMousePosition from './mouse'
  export default {
    setup() {
      const { x, y } = useMousePosition()
      return { x, y }
    }
  }
</script>
```
å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®æ¥æºæ¸…æ™°äº†ï¼Œå³æ—¶ç¼–è¾‘å¾ˆå¤šçš„hookå‡½æ•°ï¼Œä¹Ÿä¸ä¼šå‡ºç°å‘½åå†²çªã€‚


## ä¸å…¼å®¹
----
Vue3.0æ˜¯ä½¿ç”¨ES2015çš„è¯­æ³•å¼€å‘çš„ï¼Œæœ‰äº›APIå¦‚Proxyæ˜¯æ²¡æœ‰polyfillçš„ï¼Œä¸å…¼å®¹IE11


----
æ€»ç»“ï¼šå¤§åŠŸå‘ŠæˆâœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸âœŒï¸


å‚è€ƒé“¾æ¥:
* [Monorepoâ€”â€”å¤§å‹å‰ç«¯é¡¹ç›®çš„ä»£ç ç®¡ç†æ–¹å¼](https://segmentfault.com/a/1190000019309820?utm_source=tag-newest)
* [https://kaiwu.lagou.com/course/courseInfo.htm?courseId=326#/detail/pc?id=4054](https://kaiwu.lagou.com/course/courseInfo.htm?courseId=326#/detail/pc?id=4054)
